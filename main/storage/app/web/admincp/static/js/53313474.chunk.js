(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-chat-components-ChatRoomPanel-Block"],{30998:function(e,t,n){var a=n(41848),i=n(67206),r=n(40554),l=Math.max;e.exports=function(e,t,n){var o=null==e?0:e.length;if(!o)return -1;var s=null==n?0:r(n);return s<0&&(s=l(o+s,0)),a(e,i(t,3),s)}},87229:function(e,t,n){"use strict";n.d(t,{Z:function(){return v}});var a=n(16473),i=n(81719),r=n(67294),l=n(30120);let o="PreviewUploadFile",s=(0,i.ZP)("img",{name:o,slot:"previewImage"})(({theme:e})=>({borderRadius:e.spacing(1),maxWidth:"52px",width:"52px",height:"52px",marginRight:e.spacing(2),objectFit:"cover"})),c=(0,i.ZP)("div",{name:o,slot:"PreviewFile",shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({borderRadius:e.spacing(1),maxWidth:"150px",width:"150px",height:"52px",marginRight:e.spacing(2),fontSize:e.spacing(1.5),display:"flex",alignItems:"center",background:"light"===e.palette.mode?e.palette.background.default:e.palette.grey["500"],...t&&{maxWidth:"180px",width:"180px",overflowX:"hidden"}})),d=(0,i.ZP)("div",{name:o,slot:"IconFile"})(({theme:e})=>({borderRadius:"100%",maxWidth:"28px",width:"28px",height:"28px",margin:e.spacing(0,1),padding:e.spacing(0,1),color:e.palette.default.contrastText,background:"light"===e.palette.mode?e.palette.grey["500"]:e.palette.grey["700"],display:"inline-flex",justifyContent:"center",alignItems:"center"})),m=(0,i.ZP)("div",{name:o,slot:"closeButton"})(({theme:e})=>({position:"absolute",top:"-8px",right:"8px",cursor:"pointer",width:e.spacing(2.5),height:e.spacing(2.5),backgroundColor:e.palette.grey["500"],borderRadius:"50%",fontSize:e.mixins.pxToRem(8),justifyContent:"center",alignItems:"center",display:"inline-flex",opacity:.8,color:(e.palette.mode,e.palette.text.primary),"&:hover":{backgroundColor:e.palette.background.default,color:e.palette.text.primary,border:e.mixins.border("secondary")}})),p=(0,i.ZP)(a.Ys)(({theme:e})=>({paddingRight:e.spacing(1),wordBreak:"break-word",p:{fontSize:e.mixins.pxToRem(13)}}));var u=function({onRemove:e,file:t,isAllPage:n}){let i=t.type,o=["image/gif","image/jpeg","image/png"].includes(i),u=o?URL.createObjectURL(t):"";return r.createElement(l.Z,{display:"inline-flex",position:"relative"},o?r.createElement(s,{src:u,alt:"Preview"}):r.createElement(c,{isAllPage:n},r.createElement(d,null,r.createElement(a.zb,{icon:"ico-paperclip-alt"})),r.createElement(p,{lines:2},t.name)),r.createElement(l.Z,{position:"absolute",top:1,right:1},r.createElement(m,{"data-testid":"buttonRemove",onClick:e,"aria-label":"Close"},r.createElement(a.zb,{icon:"ico-close"}))))};let g=(0,i.ZP)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({background:e.palette.background.paper,padding:e.spacing(2,1,0,1),display:"flex",overflow:"hidden",borderTop:e.mixins.border("secondary"),userSelect:"none",height:"85px",minHeight:"85px",...t&&{height:"90px",minHeight:"90px"}})),h=(0,i.ZP)("div")(({theme:e})=>({display:"flex",overflowX:"auto",paddingTop:e.spacing(1),marginBottom:e.spacing(.5),paddingBottom:e.spacing(.5),"&::-webkit-scrollbar":{height:"5px",width:"5px",background:"transparent",borderRadius:e.spacing(.5),transition:"opacity 200ms"},"&::-webkit-scrollbar-track":{margin:e.spacing(.5,0),borderRadius:e.spacing(.5),background:"light"===e.palette.mode?"white":e.palette.grey["300"]},"&::-webkit-scrollbar-thumb":{background:e.palette.grey["600"],borderRadius:e.spacing(.5)},"&::-webkit-scrollbar-thumb:hover":{background:e.palette.grey["700"]},"&::-webkit-scrollbar-thumb:horizontal":{background:e.palette.grey["700"],borderRadius:"10px"}})),f=(0,i.ZP)("div",{slot:"ButtonAdd"})(({theme:e})=>({marginRight:e.spacing(1),cursor:"pointer",span:{background:"light"===e.palette.mode?e.palette.background.default:e.palette.grey["500"],"&:hover":{background:e.palette.action.hover},borderRadius:e.spacing(1),maxWidth:"52px",width:"52px",height:"52px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:e.spacing(2.5)}}));var v=r.forwardRef(function({filesUploadRef:e,isAllPage:t},n){let[i,l]=r.useState([]),[o,s]=r.useState("image"),c=r.useRef(),d=r.useRef(),m=t=>{let n=[...i];if(t>-1&&(n.splice(t,1),l([...n]),e)){var a;null===(a=e.current)||void 0===a||a.removeFile(t)}};if(r.useImperativeHandle(n,()=>{return{attachFiles:e=>{(null==e?void 0:e.length)&&l(e)},typeUpload:e=>{e&&s(e)},clear:()=>{l([])},checkIsLoading:()=>{}}}),!i||!(null==i?void 0:i.length))return null;let p=()=>{c.current.click()},v=()=>{d.current.click()},y=()=>{if("image"===o){p();return}v()},x=()=>{if(!c.current.files.length)return;let t=[...i,...c.current.files];if(l(t),e){var n;null===(n=e.current)||void 0===n||n.attachFiles(t)}},b=()=>{if(!d.current.files.length)return;let t=[...i,...d.current.files];if(l(t),e){var n;null===(n=e.current)||void 0===n||n.attachFiles(t)}};return r.createElement(g,{isAllPage:t},r.createElement(h,null,Object.values(i).map((e,n)=>r.createElement(u,{key:n,file:e,onRemove:()=>m(n),isAllPage:t})),r.createElement(f,{onClick:y},r.createElement("span",null,r.createElement(a.zb,{icon:"ico-text-file-plus"})))),r.createElement("input",{"data-testid":"inputAttachPhoto",onChange:x,multiple:!0,ref:c,style:{display:"none"},type:"file",accept:"image/*"}),r.createElement("input",{style:{display:"none"},type:"file",multiple:!0,ref:d,onChange:b}))})},46781:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return es}});var a=n(85597),i=n(37344),r=n(21241),l=n(16473),o=n(81719),s=n(62097),c=n(30120),d=n(35705),m=n(67294),p=n(10159),u=n(27274),g=n(21822),h=n(81674),f=n(23279),v=n.n(f);let y=(0,o.ZP)("div")(()=>({width:"100%"})),x=(0,o.ZP)(h.ZP,{shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({maxWidth:"600px",height:e.spacing(5),margin:e.spacing(2),padding:e.spacing(1.5,2),borderRadius:e.spacing(2.5),border:e.mixins.border("secondary"),backgroundColor:"dark"===e.palette.mode?e.palette.grey["700"]:e.palette.grey["100"],...t&&{margin:0,width:"100%",padding:e.spacing(0,1),"& input":{padding:e.spacing(.25,1,0,1)}}})),b=(0,o.ZP)(l.zb,{shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({color:e.palette.text.primary,transition:"all .2s ease",cursor:"pointer",...t&&{padding:e.spacing(1)}}));(0,o.ZP)("div",{shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({display:"inline-flex",alignItems:"center",justifyContent:"center",margin:"0",color:e.palette.grey["600"],marginRight:e.spacing(1.5),...t&&{marginRight:e.spacing(.75)}})),(0,o.ZP)("span")(({theme:e})=>({marginRight:e.spacing(0,.25),color:e.palette.text.primary}));var w=function({toggleSearch:e,room:t,searching:n}){let{i18n:i,dispatch:r,useIsMobile:l}=(0,a.OgA)(),o=l(),s=m.useRef();m.useEffect(()=>{s.current="",p()},[n]);let c=e=>{s.current=e.target.value,p()},d=m.useCallback(()=>{r({type:"chat/room/searchMessages",payload:{roomId:null==t?void 0:t.id,text:s.current},meta:{}})},[r,t]),p=m.useMemo(()=>{return v()(d,200)},[d]);return o?m.createElement(y,null,m.createElement(x,{isMobile:o,startAdornment:m.createElement(b,{icon:"ico-search-o",isMobile:o}),endAdornment:m.createElement(b,{icon:"ico-close",onClick:e}),placeholder:i.formatMessage({id:"search_this_conversation"}),autoComplete:"off",inputProps:{"aria-label":"search","data-testid":"searchBox",autoComplete:"off",autoCapitalize:"off"},inputRef:s,onChange:c})):m.createElement(y,null,m.createElement(x,{startAdornment:m.createElement(b,{icon:"ico-search-o"}),endAdornment:m.createElement(b,{icon:"ico-close",onClick:e}),placeholder:i.formatMessage({id:"search_this_conversation"}),autoComplete:"off",inputProps:{"aria-label":"search","data-testid":"searchBox",autoComplete:"off",autoCapitalize:"off"},inputRef:s,onChange:c}))};let E=(0,o.ZP)("div",{shouldForwardProp:e=>"isMobile"!==e&&"openSearch"!==e})(({theme:e,isMobile:t,openSearch:n})=>({backgroundColor:e.palette.background.paper,alignItems:"center",boxSizing:"border-box",display:"flex",height:e.spacing(9),padding:e.spacing(1,1,1,2),justifyContent:"space-between",borderBottom:e.mixins.border("secondary"),...t&&!n&&{padding:e.spacing(1,.5,1,1)}})),P=(0,o.ZP)("div")(({theme:e})=>({})),k=(0,o.ZP)("div")(({theme:e})=>({padding:e.spacing(1.75,0),display:"flex",alignItems:"center",cursor:"pointer"})),C=(0,o.ZP)("span")(({theme:e})=>({...e.typography.h4,margin:e.spacing(0,1.5,0,2)})),Z=(0,o.ZP)(g.Z,{shouldForwardProp:e=>"isInfo"!==e})(({theme:e,isInfo:t})=>({color:"light"===e.palette.mode?e.palette.grey["600"]:e.palette.text.primary,fontSize:e.spacing(2.25),minWidth:e.spacing(6.25),...t&&{color:e.palette.primary.main},padding:0,margin:0})),M=(0,o.ZP)("div")(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center"})),R=(0,o.ZP)("div")(({theme:e})=>({flex:1,display:"flex",alignItems:"center",justifyContent:"space-between"})),A=(0,o.ZP)(g.Z,{shouldForwardProp:e=>"isInfo"!==e})(({theme:e,isInfo:t})=>({color:"light"===e.palette.mode?e.palette.grey["600"]:e.palette.text.primary,fontSize:e.spacing(2.25),minWidth:e.spacing(4),...t&&{color:e.palette.primary.main}}));var I=function({room:e,searching:t}){let{dispatch:n,useActionControl:r,useIsMobile:o,navigate:s,useGetItem:c}=(0,a.OgA)(),d=o(),[g,h]=m.useState(!1),f=(null==e?void 0:e.other_members[0])||void 0,v=c(f),[y]=r(null==e?void 0:e.id,{}),x=(t,a,i)=>{y(t,a,i),"chat/room/toggleSearching"===t&&(n({type:"chat/room/searchMessages",payload:{roomId:null==e?void 0:e.id,text:""}}),h(e=>!e))},b=(0,p.Mn)(),I=m.useMemo(()=>(0,u.W$)(b,{isMobile:d}),[b,d]);m.useEffect(()=>{h(!1)},[e]);let S=m.useCallback(()=>{n({type:"chat/room/toggleSearching",payload:{identity:null==e?void 0:e.id}}),n({type:"chat/room/searchMessages",payload:{roomId:null==e?void 0:e.id,text:""}}),h(e=>!e)},[n,e]),O=()=>{s({pathname:"/messages"})};return d?m.createElement(E,{isMobile:d,openSearch:g},g?null:m.createElement(Z,{onClick:O},m.createElement(l.zb,{icon:"ico-arrow-left"})),g?m.createElement(w,{toggleSearch:S,room:e,searching:t}):m.createElement(R,null,m.createElement(k,null,m.createElement(l.Yt,{user:v,size:48}),m.createElement(C,null,null==e?void 0:e.name)),m.createElement(P,null,m.createElement(M,null,m.createElement(i.BB,{items:I,handleAction:x,displayLimit:2}))))):m.createElement(E,null,m.createElement(k,null,e?m.createElement(l.Yt,{user:v,size:48}):null,m.createElement(C,null,null==e?void 0:e.name)),m.createElement(P,null,g?m.createElement(w,{toggleSearch:S,room:e,searching:t}):m.createElement(M,null,m.createElement(A,{onClick:S},m.createElement(l.zb,{icon:"ico-search-o"})),m.createElement(i.BB,{items:I,handleAction:y,variant:"pageMessage"}))))},S=n(1469),O=n.n(S);let _="ChatRoomPanel",F=(0,o.ZP)("div")(({theme:e})=>({display:"flex",flexDirection:"column",borderLeft:e.mixins.border("secondary"),backgroundColor:e.palette.background.paper,width:"100%",height:"100%"})),z=(0,o.ZP)("div",{name:_,slot:"mainContent"})(({theme:e})=>({display:"flex",flexDirection:"row",alignItems:"center",borderBottom:e.mixins.border("secondary")})),T=(0,o.ZP)("div")(({theme:e})=>({display:"flex",flexDirection:"row",backgroundColor:e.palette.background.paper,flex:1})),B=(0,o.ZP)("div")(({theme:e})=>({flex:1,display:"flex",flexDirection:"column",width:"100%",minWidth:0})),W=(0,o.ZP)("div",{name:_,slot:"Title"})(({theme:e})=>({fontSize:e.spacing(1.875),padding:e.spacing(3.5,2),fontWeight:e.typography.fontWeightMedium,alignSelf:"flex-start",color:e.palette.text.secondary,minWidth:"130px"})),j=(0,o.ZP)("div",{name:_,slot:"SearchWrapper"})(({theme:e})=>({flex:1,minWidth:0,margin:e.spacing(1),position:"relative",zIndex:e.zIndex.speedDial})),D=(0,o.ZP)("div",{name:_,slot:"WrapperSuggest",shouldForwardProp:e=>"suggestList"!==e})(({theme:e,suggestList:t})=>({...!0===t&&{position:"absolute",width:"100%",border:e.mixins.border("secondary"),borderTop:"none",backgroundColor:e.palette.background.paper,borderEndEndRadius:e.spacing(1),borderEndStartRadius:e.spacing(1)}})),H=(0,o.ZP)("div")(({theme:e})=>({padding:e.spacing(1.75,2),display:"flex",alignItems:"center",cursor:"pointer",borderBottom:e.mixins.border("secondary"),"&:last-child":{borderBottom:"none"}})),L=(0,o.ZP)("span")(({theme:e})=>({...e.typography.h5,marginLeft:e.spacing(1)}));var N=function(){let{i18n:e,dispatch:t,apiClient:n}=(0,a.OgA)(),o=m.useRef(""),[s,c]=m.useState(""),[d,p]=m.useState(!1),[u,g]=m.useState([]),h=m.useMemo(()=>{let e=()=>{n.get("/friend",{params:{limit:10,q:o.current||void 0}}).then(e=>e.data.data).then(e=>O()(e)&&g(e)).catch(e=>{})};return v()(e,200)},[n,o.current]);m.useEffect(()=>{h()},[]);let f=m.useCallback(e=>{t({type:"chat/newChatRoom",payload:{user:e,isPage:!0}})},[]),y=m.useCallback(e=>{},[]),x=m.useCallback(e=>{var t;let n=null===(t=e.currentTarget)||void 0===t?void 0:t.value;o.current=n,c(n),h(),p(!0)},[]),b=()=>{p(!1)};return m.createElement(F,null,m.createElement(z,null,m.createElement(W,null,e.formatMessage({id:"new_message"})),m.createElement(l.Qn,{onClickAway:b},m.createElement(j,null,m.createElement(i.zj,{sx:{p:0},valueSearch:s,onChangeSearch:x,onKeyUp:y,placeholder:e.formatMessage({id:"type_name_start_new_conversation"}),size:30,isShowButtonSubmit:!1}),d?m.createElement(D,{suggestList:Boolean(u&&u.length)},m.createElement("div",null,m.createElement(r.l$,{autoHide:!0,autoHeight:!0},u.map((e,t)=>m.createElement(m.Fragment,{key:t},m.createElement(H,{onClick:()=>f(e)},m.createElement(l.Yt,{user:e,size:32,noLink:!0}),m.createElement(L,null,e.full_name))))))):null))),m.createElement(T,null,m.createElement(B,null)))},$=n(41609),U=n.n($),Q=n(81321),G=n(48309),Y=n(40263),q=n(87229);let K="ChatRoomPanel",V=(0,o.ZP)("div",{name:K,slot:"root",shouldForwardProp:e=>"loading"!==e})(({theme:e,loading:t})=>({borderLeft:e.mixins.border("secondary"),backgroundColor:e.palette.background.paper,display:"flex",flexDirection:"row",width:"100%",height:"100%","& .MuiAvatar-root":{fontSize:e.mixins.pxToRem(14)}})),X=(0,o.ZP)("div",{name:K,slot:"mainContent"})(({theme:e})=>({flex:1,display:"flex",width:"100%",height:"100%"})),J=(0,o.ZP)("div")(({theme:e})=>({display:"flex",flexDirection:"row",width:"100%",flex:1,minHeight:0})),ee=(0,o.ZP)("div",{name:K,slot:"Main",shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({flex:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"})),et=(0,o.ZP)("div")(({theme:e})=>({textAlign:"center",padding:e.spacing(2),fontStyle:"italic",color:"dark"===e.palette.mode?e.palette.text.primary:e.palette.grey["700"],fontSize:e.spacing(1.75)})),en=(0,o.ZP)("div",{name:K,slot:"ReplyEditWrapper"})(({theme:e})=>({padding:e.spacing(.625,1.25),height:"50px",width:"100%",borderTop:e.mixins.border("secondary"),display:"flex",justifyContent:"space-between",backgroundColor:"dark"===e.palette.mode?e.palette.grey["600"]:e.palette.grey["100"]})),ea=(0,o.ZP)(l.Ys,{name:K,slot:"SelectedMsg"})(({theme:e})=>({color:e.palette.text.primary})),ei=(0,o.ZP)(l.zb,{name:K,slot:"LineIconClose"})(({theme:e})=>({cursor:"pointer",alignSelf:"center"})),er=(0,o.ZP)("div",{name:K,slot:"SelectedMsgAttachment"})(({theme:e})=>({fontSize:e.spacing(1.5),margin:e.spacing(.5,0),"& .ico":{marginRight:e.spacing(.5)}})),el=(0,o.ZP)("div",{name:K,slot:"ContentWrapper"})(({theme:e})=>({overflow:"hidden"})),eo=(0,o.ZP)("div",{name:K,slot:"LoadingStyled"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",marginTop:e.spacing(3)}));var es=(0,a.j4Z)({name:"ChatRoomPanel",extendBlock:function(e){let{i18n:t,jsxBackend:n,usePageParams:o,useActionControl:u,dispatch:g,useIsMobile:h}=(0,a.OgA)(),f=o(),{rid:v}=f,y=h(),x=m.useRef(),b=m.useRef(),w=m.useRef(),E=m.useRef(),P=(0,p.pB)(v),[k]=u(v,{}),[C,Z]=(0,m.useState)("no_react"),[M,R]=(0,m.useState)(),[A,S]=(0,m.useState)(void 0),[O,_]=(0,m.useState)(!1),F=(0,a.z88)(null==M?void 0:M.user),[z,T]=m.useState(!1),B=(0,s.Z)(),W=null==P?void 0:P.searching,j=n.get("ChatSimpleComposer"),D=m.useRef(),H=e=>{if(e.target.scrollTop<100&&!z){let{lastMsgId:t,endLoadmoreMessage:n}=P;t&&!n&&(D.current=e.target.scrollHeight-e.target.clientHeight,T(!0),g({type:"chat/room/loadHistory",payload:{rid:v,lastMsgId:t},meta:{onSuccess:()=>{T(!1)}}}))}};m.useEffect(()=>{if(!(null==P?void 0:P.lastMsgId)||!D.current)return;let e=x.current.scrollHeight-x.current.clientHeight;x.current.scrollTop=0+(e-D.current),D.current=0},[null==P?void 0:P.lastMsgId]);let L=()=>{Z("no_react"),R(void 0)},$=m.useCallback(()=>{v&&g({type:"chat/room/markAsRead",payload:{identity:v}})},[v,g]);m.useEffect(()=>{return v&&(_(!0),g({type:"chat/room/markAsRead",payload:{identity:v}}),g({type:"chat/room/active",payload:v,meta:{onSuccess:e=>{S(e),_(!1)},onFailure:()=>{_(!1)}}})),()=>{g({type:"chat/room/inactive",payload:{rid:v}}),g({type:"chat/room/closeSearching",payload:{identity:v}}),L(),S(void 0)}},[v]);let K=null==P?void 0:P.messageFilter,es={backgroundColor:B.palette.background.paper},ec=m.useMemo(()=>{return(null==M?void 0:M.message)?(0,Y.Hj)(null==M?void 0:M.message):""},[M]);if(!v&&!y&&!A)return m.createElement(N,null);let ed=(e,t)=>{if(!e)return;let n=e.split(/.,| /);n.forEach(e=>{switch(e){case"chat/replyMessage":Z("reply"),R(t);break;case"chat/editMessage":Z("edit"),R(t)}})},em=()=>{L(),(null==E?void 0:E.current)&&E.current.scrollToBottom()};return m.createElement(V,{loading:O||!A&&v},m.createElement(X,null,m.createElement(J,null,m.createElement(ee,{isMobile:y},m.createElement(I,{room:A,searching:W}),m.createElement(c.Z,{sx:{flex:1,minHeight:0}},m.createElement(r.l$,{autoHeight:!0,autoHeightMax:"100%",ref:x,style:es,onScroll:H},W||O||!(null==P?void 0:P.endLoadmoreMessage)?null:m.createElement(et,null,t.formatMessage({id:"start_of_conversation"})),O&&m.createElement(eo,{"data-testid":"loadingIndicator"},m.createElement(d.Z,{size:24})),W&&K?m.createElement(c.Z,{sx:{mt:2}},m.createElement(G.Z,{items:K,room:A,disableReact:!0,handleAction:k})):m.createElement(Q.Z,{rid:v,groups:null==P?void 0:P.groups,groupIds:null==P?void 0:P.groupIds,newest:null==P?void 0:P.newest,preFetchingMsg:null==P?void 0:P.preFetchingMsg,room:A,containerRef:x,disableReact:!1,handleAction:ed,ref:E,loading:O,roomProgress:null==P?void 0:P.roomProgress,isAllPage:!0}))),"no_react"!==C&&m.createElement(en,null,m.createElement(el,null,m.createElement("div",null,"reply"===C?t.formatMessage({id:"reply_to_user_at_timestamp"},{user:null==F?void 0:F.full_name,time:new Date(M.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}):t.formatMessage({id:"editing"})),U()(null==M?void 0:M.attachments)?m.createElement(ea,{lines:1,dangerouslySetInnerHTML:{__html:ec}}):m.createElement(er,null,m.createElement(l.zb,{icon:"ico-paperclip-alt"}),m.createElement("span",null,t.formatMessage({id:"file_attachment"})))),m.createElement(ei,{icon:"ico-close",onClick:()=>Z("no_react")})),m.createElement(q.Z,{ref:b,filesUploadRef:w,isAllPage:!0}),m.createElement(i.jH,{searching:W},m.createElement(j,{rid:v,msgId:null==M?void 0:M.id,reactMode:C,text:"edit"===C?ec:"",onSuccess:em,previewRef:b,ref:w,isAllPage:!0,onMarkAsRead:$}))))))}})},37344:function(e,t,n){"use strict";n.d(t,{zj:function(){return u},s_:function(){return R},KG:function(){return h},jH:function(){return w},V9:function(){return P},pY:function(){return U},BB:function(){return K},ay:function(){return L}});var a,i,r=n(16473),l=n(30120),o=n(21822),s=n(81719),c=n(67294);let d=(0,s.ZP)("div",{name:"ChatDockFilter"})(({theme:e})=>({position:"relative"})),m=(0,s.ZP)(l.Z,{name:"ChatDockFilter"})(({theme:e})=>({padding:e.spacing(1,1,1,2),display:"flex",flexDirection:"row",alignItems:"center"})),p=(0,s.ZP)(o.Z,{name:"ChatDockFilter"})(({theme:e})=>({marginLeft:e.spacing(.5)}));function u({placeholder:e,size:t,hide:n,label:a,disabled:i,valueSearch:l,onChangeSearch:o,onKeyUp:s,onSubmit:u,variant:g="direct",isShowButtonSubmit:h=!0,sx:f}){return n?null:c.createElement(d,null,c.createElement(m,{sx:f},c.createElement(r.Rj,{placeholder:e,onKeyUp:s,value:l,onChange:o}),h&&u?c.createElement(p,{disabled:i,size:"medium",color:"primary",variant:"text",onClick:u},a):null))}let g=(0,s.ZP)("div",{name:"ChatDockContent",slot:"root",shouldForwardProp:e=>"searching"!==e&&"collapsed"!==e})(({theme:e,searching:t,collapsed:n})=>({flex:1,maxHeight:"100%",position:"relative",paddingBottom:e.spacing(.75),...t&&{borderTop:"none"},...n&&{display:"none"},"&::-webkit-scrollbar":{height:"5px",width:"5px",background:"gray",borderRadius:e.spacing(.5),transition:"opacity 200ms"},"&::-webkit-scrollbar-track":{borderRadius:e.spacing(.5),background:"light"===e.palette.mode?"white":e.palette.grey["300"]},"&::-webkit-scrollbar-thumb":{background:e.palette.grey["600"],borderRadius:e.spacing(.5)},"&::-webkit-scrollbar-thumb:hover":{background:e.palette.grey["700"]},"&::-webkit-scrollbar-thumb:horizontal":{background:"#000",borderRadius:"10px"}}));var h=c.forwardRef(function({children:e,searching:t,collapsed:n},a){return c.createElement(g,{ref:a,searching:t,collapsed:n},e)}),f=n(85597);let v="ChatDockFooter",y=(0,s.ZP)("div",{name:v,slot:"root",shouldForwardProp:e=>"isAllPageMessages"!==e})(({theme:e,isAllPageMessages:t})=>({position:"relative",display:"flex",minHeight:e.spacing(5),zIndex:2,backgroundColor:e.palette.background.paper,borderTop:e.mixins.border("secondary"),...t&&{minHeight:e.spacing(6)}})),x=(0,s.ZP)("div",{name:v,slot:"uiChatRoomFooter",shouldForwardProp:e=>"disable"!==e&&"isAllPageMessages"!==e})(({theme:e,disable:t,isAllPageMessages:n})=>({position:"relative",borderTop:e.mixins.border("secondary"),display:"flex",alignItems:"flex-end",minHeight:e.spacing(5),zIndex:2,flexFlow:"wrap",justifyContent:"center",...t&&{userSelect:"none",backgroundColor:"dark"===e.palette.mode?e.palette.grey["700"]:e.palette.background.paper},...n&&{minHeight:e.spacing(6)}})),b=(0,s.ZP)("div",{name:v,slot:"uiChatComposerContainer"})(({theme:e})=>({textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",height:"100%",padding:"4px 8px",color:e.palette.grey["500"]}));function w({children:e,archived:t,isReadOnly:n,isMuted:a,searching:i}){let{i18n:r,usePageParams:l}=(0,f.OgA)(),o=l(),s=(null==o?void 0:o.isAllPageMessages)||!1;return i?null:t?c.createElement(x,{disable:!0,isAllPageMessages:s},c.createElement(b,null,r.formatMessage({id:"this_group_is_archived"}))):n?c.createElement(x,{disable:!0,isAllPageMessages:s},c.createElement(b,null,r.formatMessage({id:"this_group_is_readonly"}))):a?c.createElement(x,{disable:!0,isAllPageMessages:s},c.createElement(b,null,r.formatMessage({id:"you_have_been_muted_in_this_group"}))):c.createElement(y,{isAllPageMessages:s},e)}let E=(0,s.ZP)("div",{shouldForwardProp:e=>"searching"!==e&&"addNewMembers"!==e})(({theme:e,searching:t,addNewMembers:n})=>({display:"flex",alignItems:"center",minHeight:e.spacing(7),padding:e.spacing(1.5,1.25,1.5,2),borderBottom:e.mixins.border("secondary"),...(t||n)&&{borderBottom:"none"}}));function P({children:e,onClick:t,searching:n,addNewMembers:a}){let i=c.useCallback(e=>{e.preventDefault(),t&&t()},[t]);return c.createElement(E,{onClick:i,searching:n,addNewMembers:a},e)}let k="ChatDockPanel",C=(0,s.ZP)("div",{name:k,slot:"Root"})(({theme:e})=>({display:"flex",alignItems:"flex-end",marginLeft:e.spacing(2),width:"328px",zIndex:999})),Z=(0,s.ZP)("div",{name:k,slot:"PanelStyled"})(({theme:e})=>({display:"flex",flexDirection:"column",zIndex:10,backgroundColor:e.mixins.backgroundColor("paper"),borderTopLeftRadius:"4px",borderTopRightRadius:"4px",boxShadow:"0 0 4px 0 rgba(0,0,0,0.2)",wordBreak:"break-word",wordWrap:"break-word",borderStartStartRadius:e.spacing(1),borderStartEndRadius:e.spacing(1),height:"455px",maxHeight:"calc(100vh - 60px)"})),M=(0,s.ZP)("div",{name:k,slot:"StageStyled"})(({theme:e})=>({width:"100%"}));var R=c.forwardRef(function({children:e},t){return c.createElement(C,{ref:t},c.createElement(M,null,c.createElement(Z,null,e)))}),A=n(81674),I=n(86010),S=n(23279),O=n.n(S),_=n(22410),F=n(73327),z=(0,_.Z)(e=>(0,F.Z)({optionLabel:{width:"32px",height:"32px",display:"inline-flex",alignItems:"center",justifyContent:"center",margin:"0",color:"#a2a2a2"},optionChecked:{color:e.palette.primary.main},optionInput:{display:"none"},optionIcon:{display:"inline-flex",alignItems:"center",marginTop:"1px",height:"14px",marginRight:"4px"}}),{name:"ChatDockSearchFilter"});let T=(0,s.ZP)("div")(({theme:e})=>({})),B=(0,s.ZP)("div")(({theme:e})=>({display:"inline-flex"})),W=(0,s.ZP)(A.ZP)(({theme:e})=>({display:"flex",width:"100%","&.Mui-focused":{borderColor:e.palette.primary.main}})),j=(0,s.ZP)(l.Z,{name:"SearchBox",slot:"Root"})(({theme:e})=>({margin:e.spacing(0,2,1,2),height:e.spacing(5),borderRadius:e.spacing(2.5),display:"flex",alignItems:"center",backgroundColor:e.palette.action.hover}));function D({id:e,checked:t,icon:n,classes:a,value:i,roomId:l,onClick:o}){let{dispatch:s}=(0,f.OgA)(),d=()=>{s({type:i,payload:{identity:l}}),"function"==typeof o&&o(t?void 0:e)};return c.createElement("label",{className:(0,I.default)(a.optionLabel,t&&a.optionChecked)},c.createElement("input",{className:a.optionInput,type:"checkbox"}),c.createElement(r.zb,{icon:n,className:a.optionIcon,onClick:d}))}let H=({placeholder:e,size:t,hide:n,options:a=[],roomId:i,searching:o=!1})=>{let s=z(),{dispatch:d}=(0,f.OgA)(),m=(0,c.useRef)(null),p=(0,c.useRef)(null);(0,c.useEffect)(()=>{m.current="",p.current=null,v()},[o]);let u=e=>{m.current=e.target.value,v()},g=e=>{p.current=e,v()},h=(0,c.useCallback)(()=>{d({type:"chat/room/searchMessages",payload:{roomId:i,text:m.current}})},[d,i]),v=(0,c.useMemo)(()=>{return O()(h,200)},[h]);return((0,c.useEffect)(()=>{var e;a.length&&(p.current=null===(e=a.find(e=>e.checked))||void 0===e?void 0:e.id)},[a]),n)?null:c.createElement(T,null,c.createElement(j,null,c.createElement(W,{variant:"search",onChange:u,placeholder:e,startAdornment:c.createElement(r.zb,{icon:"ico-search-o"}),"aria-controls":"search_complete",endAdornment:c.createElement(l.Z,null,a&&a.length?c.createElement(B,null,a.map(e=>{return c.createElement(D,{id:e.id,key:e.id.toString(),checked:null==e?void 0:e.checked,classes:s,icon:e.icon,value:e.value,roomId:i,onClick:g})})):null)})))};var L=(0,c.memo)(H);(a=i||(i={})).Direct="d",a.Private="p",a.Public="c",a.OnlyUser="u",n(71682);let N=(0,s.ZP)("div")(({theme:e})=>({flex:1,fontWeight:"bold",display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"})),$=(0,s.ZP)("span",{shouldForwardProp:e=>"variant"!==e})(({theme:e,variant:t,type:n})=>({...e.typography.subtitle1,fontSize:"15px",lineHeight:e.spacing(2.375),...n===i.Direct&&{":hover":{cursor:"pointer",textDecoration:"underline"}},..."new_message"===t&&{fontSize:e.typography.pxToRem(18),":hover":{cursor:"auto",textDecoration:"none"}}}));function U({room:e,children:t,status:n,user:a,variant:r,isSelfChat:l=!1,loading:o=!1}){let{navigate:s}=(0,f.OgA)(),d=()=>{let t=a&&(a.username||a.user_name);(null==e?void 0:e.t)===i.Direct&&t&&s(`/${t}`)};return(null==e?void 0:e.t)===i.Direct?c.createElement(N,null,c.createElement($,{onClick:d,type:null==e?void 0:e.t},t)):c.createElement(N,null,c.createElement($,{type:null==e?void 0:e.t,variant:r},t))}var Q=n(30998),G=n.n(Q),Y=(0,_.Z)(e=>(0,F.Z)({root:{display:"flex",padding:"0",margin:"0",listStyle:"none"},item:{position:"relative",lineHeight:"34px",padding:"0",margin:"0",".panelHeader &":{height:"30px",width:"30px",marginLeft:e.spacing(.5)},".panelHeader &:hover button":{color:e.palette.text.secondary,backgroundColor:e.palette.action.selected,borderRadius:"50%"}},btn:{height:"34px",lineHeight:"20px",fontSize:"17px",padding:"0 6px",cursor:"pointer",color:e.palette.text.hint,position:"relative",minWidth:e.spacing(3),display:"inline-flex",textAlign:"center",alignItems:"center",justifyContent:"center",border:"none",outline:"none",backgroundColor:"transparent",".panelHeader &":{height:"30px",width:"30px"}},itemActive:{},btnActive:{color:e.palette.primary.main}}),{name:"ChatDockToolbar"});let q=(0,s.ZP)("div",{name:"ToolbarChat",slot:"root",shouldForwardProp:e=>"variant"!==e})(({theme:e,variant:t})=>({display:"flex",padding:"0",margin:"0",listStyle:"none","& .MuiActionMenu-menu":"roomPanel"===t&&{overflow:"auto",maxHeight:"200px","&::-webkit-scrollbar":{height:"5px",width:"5px",background:"transparent",borderRadius:e.spacing(.5),transition:"opacity 200ms"},"&::-webkit-scrollbar-track":{margin:e.spacing(.5,0),borderRadius:e.spacing(.5),background:"light"===e.palette.mode?"white":e.palette.grey["300"]},"&::-webkit-scrollbar-thumb":{background:e.palette.grey["600"],borderRadius:e.spacing(.5)},"&::-webkit-scrollbar-thumb:hover":{background:e.palette.grey["700"]},"&::-webkit-scrollbar-thumb:horizontal":{background:"#000",borderRadius:"10px"}}}));function K({items:e,displayLimit:t=2,variant:n=null,handleAction:a}){var i,l,o;let s=Y();if(!Array.isArray(e))return null;if("roomPanel"===n){let d=t-1,m=e.filter((e,t)=>{return t<d||e.behavior}),p=G()(m,{behavior:"more"});if(p>-1){if(null===(i=m[p].items)||void 0===i?void 0:i.length)m[p].as="dropdown";else{let u=e.filter((e,t)=>t>d-1&&!e.behavior);m[p]={...m[p],items:u,as:"dropdown"}}}return c.createElement(q,{variant:n},c.createElement(r.sd,{items:m,prefixName:"chatplusToolbar.item.",fallbackName:"button",classes:s,handleAction:a}))}if("pageMessage"===n){let g=e.filter((e,t)=>{return e.behavior}),h=G()(g,{behavior:"more"});if(h>-1){if(null===(l=g[h].items)||void 0===l?void 0:l.length)g[h].as="dropdown";else{let f=e.filter((e,t)=>!e.behavior);g[h]={...g[h],items:f,as:"dropdown"}}}return c.createElement(q,{variant:n},c.createElement(r.sd,{items:g,prefixName:"chatplusToolbar.item.",fallbackName:"button",classes:s,handleAction:a,variant:n}))}let v=e.filter((e,n)=>n<t-1||e.behavior),y=G()(v,{behavior:"more"});if(y>-1){if(null===(o=v[y].items)||void 0===o?void 0:o.length)v[y].as="dropdown";else{let x=e.filter((e,n)=>n>t-2&&!e.behavior);v[y]={...v[y],items:x,as:"dropdown"}}}return c.createElement(q,null,c.createElement(r.sd,{items:v,prefixName:"chatplusToolbar.item.",fallbackName:"button",classes:s,handleAction:a}))}},48309:function(e,t,n){"use strict";n.d(t,{Z:function(){return x}});var a=n(85597),i=n(81719),r=n(41609),l=n.n(r),o=n(67294),s=n(98251),c=n(2475),d=n(86010),m=n(27937);let p=(0,i.ZP)("div",{name:"MsgItemFilter",slot:"uiChatMsgItemBody"})(({theme:e})=>({display:"flex"}));function u({msgId:e,tooltipPosition:t="top",showToolbar:n=!0,room:i,disableReact:r,handleAction:l}){let{jsxBackend:s,useSession:u,useGetItem:g,useActionControl:h}=(0,a.OgA)(),f=`chat.chatRooms.${null==i?void 0:i.id}.messageFilter.${e}`,v=g(f),{user:y}=u(),[x]=h(f,{});if(!v)return;let{id:b,attachments:w,reactions:E,type:P,created_at:k,user:C}=v||{},Z=(null==y?void 0:y.id)===(null==C?void 0:C.id),M=(0,c.jF)(k),R=(0,c.qF)(w),A=(e,t,n)=>{x(e,t,n),l(e,v,n)};return o.createElement("div",{className:"uiChatMsgItem","data-id":b,"data-t":P},o.createElement(p,null,o.createElement("div",{className:(0,d.default)("uiChatMsgItemBodyOuter",{hasToolbar:n,"multi-image":R>1})},s.render({component:`chat.messageContent.${P}`,props:{message:v,isOwner:Z,user:C,createdDate:M,msgType:P,tooltipPosition:t}}))),o.createElement(m.Z,{identity:f,disabled:r,reactions:E,handleAction:A}))}let g="MessageFilter",h=(0,i.ZP)("div",{name:g,slot:"uiChatMsgSet",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e&&"isGroup"!==e})(({theme:e,isOwner:t,isAlert:n,isGroup:a})=>({display:"flex",flexDirection:"row",padding:e.spacing(.5,2),...n&&{"&.uiChatMsgSetAvatar":{display:"none"},"&.uiChatMsgItemCall":{border:"none"},"&.uiChatMsgActions":{justifyContent:"center","&.my-1; .btn":{"&.mx-1":"!important"}}},...t&&{flexDirection:"row-reverse"}})),f=(0,i.ZP)("div",{name:g,slot:"uiChatMsgSetAvatar"})(({theme:e})=>({marginRight:e.spacing(1)})),v=(0,i.ZP)("div",{name:g,slot:"noItemFound"})(({theme:e})=>({...e.typography.body1,padding:e.spacing(1,2),color:e.palette.grey["600"]})),y=({disableReact:e,room:t,items:n,handleAction:i})=>{let{i18n:r}=(0,a.OgA)();return l()(n)?o.createElement(v,null,r.formatMessage({id:"no_results_found"})," "):o.createElement("div",null,n&&Object.values(n).map(n=>o.createElement(h,{key:n.id.toString()},o.createElement(f,null,o.createElement(s.Z,{user:n.user,size:32})),o.createElement(u,{msgId:n.id,disableReact:e,room:t,handleAction:i}))))};var x=y},98251:function(e,t,n){"use strict";var a=n(85597),i=n(16473),r=n(67294);t.Z=(0,r.memo)(function({identity:e,size:t=30,user:n}){let{useGetItem:l}=(0,a.OgA)(),o=l(e);return n||o?r.createElement(i.Yt,{user:n||o,size:t,noLink:!0}):null})},81321:function(e,t,n){"use strict";n.d(t,{Z:function(){return eg}});var a=n(2475),i=n(85597),r=n(30120),l=n(81719),o=n(67294);let s=o.createContext(o.createRef());var c=n(98251),d=n(10159),m=n(27937),p=n(27274),u=n(86010),g=n(16473),h=n(21822),f=n(38790);let v="MsgActionMenu",y=(0,l.ZP)("div",{name:v,slot:"root"})(({theme:e})=>({"& .MuiActionMenu-menu":{overflow:"auto",maxHeight:"220px"}})),x=(0,l.ZP)(h.Z,{name:v,slot:"UIChatItemBtn"})(({theme:e})=>({position:"relative",visibility:"hidden",padding:e.spacing(1,.5),cursor:"pointer",minWidth:e.spacing(3),lineHeight:e.spacing(2.5)}));function b({identity:e,handleAction:t,scrollRef:n,items:a}){let{ItemActionMenu:r,i18n:l}=(0,i.OgA)();return o.createElement(y,null,o.createElement(r,{disablePortal:!0,items:a,placement:"auto-start",identity:e,handleAction:t,dependName:"chatplus/msgActionMenu",scrollRef:n,scrollClose:!0,control:o.createElement(f.Z,{title:l.formatMessage({id:"more"}),placement:"top",PopperProps:{disablePortal:!0}},o.createElement(x,{disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0,className:"uiChatItemBtn"},o.createElement(g.zb,{icon:"ico-dottedmore-vertical-o"})))}))}var w=n(25722),E=n(62937),P=n(40471),k=n(22410),C=n(73327),Z=n(41609),M=n.n(Z);let R=(0,k.Z)(e=>(0,C.Z)({paper:{borderRadius:24,margin:0,padding:0},itemsRoot:{display:"flex",flexDirection:"row"},itemRoot:{padding:"4px",display:"flex",alignItem:"center",alignSelf:"center"},itemImage:{width:27,height:27},active:{background:e.palette.grey["300"],padding:e.spacing(.5),borderRadius:e.spacing(1),width:34,height:34,display:"flex",alignItem:"center",justifyContent:"center",margin:e.spacing(.2)}}),{name:"ReactionThisItemPopover"}),A=({item:e,classes:t,onClick:n,active:a})=>{return o.createElement("div",{className:(0,u.default)(t.itemRoot,a&&t.active),role:"button",onClick:n,"aria-label":e.title,"data-testid":"itemReaction"},o.createElement(f.Z,{title:e.title},o.createElement("img",{src:e.src,draggable:!1,alt:e.title,className:t.itemImage})))};var I=function({onEmojiClick:e,unsetReaction:t,identity:n}){let{useSession:a}=(0,i.OgA)(),r=(0,P.z)(),l=R(),s=(0,d.v2)(n),{user:c}=a(),m=e=>{var t,n;if(M()(null==s?void 0:null===(t=s.reactions)||void 0===t?void 0:t[e]))return!1;let a=null==s?void 0:null===(n=s.reactions)||void 0===n?void 0:n[e].some(e=>e.user_name===c.user_name);return a},p=n=>{let a=m(n);a?t(n):e(n,null)};return o.createElement("div",{className:l.itemsRoot},r.map(e=>{return o.createElement(A,{key:e.id.toString(),onClick:()=>{p(`:reaction_${e.id.toString()}:`)},classes:l,item:e,active:m(`:reaction_${e.id}:`)})}))};let S=(0,l.ZP)(w.Z)(({theme:e})=>({margin:0,padding:e.spacing(0,.5),maxHeight:"48px",display:"flex",alignItems:"center",whiteSpace:"nowrap"}));function O({onEmojiClick:e,multiple:t=!0,disabled:n,scrollRef:a,scrollClose:r,placement:l="top",label:s="react",control:c,identity:d,unsetReaction:m}){let{i18n:p}=(0,i.OgA)(),u=p.formatMessage({id:s}),[h,f]=o.useState(null),v=o.useRef(),[y,x]=o.useState(!1),b=o.useCallback(()=>{x(!1)},[]),w=o.useCallback(e=>{x(e=>!e),f(h?null:e.currentTarget)},[]),P=o.useCallback((n,a)=>{e&&e(n,a),t||x(!1)},[t,e]),k=o.useCallback(e=>{m&&m(e),x(!1)},[m]);return o.useEffect(()=>{if(y&&a&&a.current&&r){let e=()=>x(!1);return a.current.addEventListener("scroll",e),()=>{null==a||a.current.removeEventListener("scroll",e)}}},[y]),o.createElement(o.Fragment,null,o.createElement(g.Qn,{excludeRef:v,onClickAway:b},o.createElement(c,{onClick:w,disabled:n,title:u,"data-testid":"buttonAttachEmoji",icon:"ico-smile-o"})),o.createElement(E.Z,{ref:v,open:y,anchorEl:h,placement:l,role:"presentation",style:{zIndex:5e3}},o.createElement(S,{"data-testid":"dialogEmojiPicker"},o.createElement(I,{onEmojiClick:P,unsetReaction:k,identity:d}))))}function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}let F=(0,l.ZP)(h.Z,{name:"MsgEmojiPicker",slot:"UIChatItemBtn"})(({theme:e})=>({position:"relative",visibility:"hidden",padding:e.spacing(1,.75),cursor:"pointer",minWidth:e.spacing(2.5),lineHeight:e.spacing(2.5)})),z=o.forwardRef(({title:e,...t},n)=>{return o.createElement(f.Z,{title:e,placement:"top",PopperProps:{disablePortal:!0}},o.createElement(F,_({className:"uiChatItemBtn uiChatIconBtn",disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0},t,{ref:n}),o.createElement(g.zb,{icon:"ico-smile-o"})))});function T({handleAction:e,scrollRef:t,identity:n}){let a=o.useCallback((t,n=null)=>e("chat/messageReaction",{shortcut:t,unicode:n}),[e]),i=o.useCallback(t=>{e("chat/unsetReaction",{identity:n,shortcut:t})},[e]);return o.createElement(O,{size:"small",multiple:!1,onEmojiClick:a,unsetReaction:i,control:z,scrollRef:t,scrollClose:!0,identity:n})}let B=(0,l.ZP)("div",{name:"MsgToolbar",slot:"uiChatToolbar",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",justifyContent:"center",alignItems:"center",...!t&&{flexDirection:"row-reverse"}}));function W({items:e,disabled:t,disableReact:n,handleAction:a,identity:r,isOwner:l}){let{useScrollRef:s}=(0,i.OgA)(),c=s();return t?null:o.createElement(B,{isOwner:l,className:"uiChatToolbar"},o.createElement(b,{identity:r,items:e,scrollRef:c,handleAction:a}),n?null:o.createElement(T,{scrollRef:c,handleAction:a,identity:r}))}let j="MsgItem",D=(0,l.ZP)("div",{name:j,slot:"uiChatMsgItem",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({...t&&{flexDirection:"row-reverse"},minHeight:"40px",marginBottom:e.spacing(.5)})),H=(0,l.ZP)("div",{name:j,slot:"uiChatMsgItemBody",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e&&"isShowReact"!==e})(({theme:e,isOwner:t,isAlert:n,isShowReact:a})=>({display:"flex","&:hover .uiChatItemBtn":{visibility:"visible"},...t&&{flexDirection:"row-reverse"},...n&&{textAlign:"center",...a&&{justifyContent:"center"}}})),L=(0,l.ZP)("div",{name:j,slot:"uiChatMsgItemBodyOuter",shouldForwardProp:e=>"hasToolbar"!==e&&"multiImage"!==e&&"isOwner"!==e&&"isPageAllMessages"!==e&&"msgType"!==e&&"msgContentType"!==e})(({theme:e,hasToolbar:t,multiImage:n,isOwner:a,isPageAllMessages:i,msgType:r,msgContentType:l})=>({maxWidth:"100%",...t&&{maxWidth:"calc(100% - 42px)"},...t&&i&&{maxWidth:"calc(65% - 42px)"},..."messageDeleted"===l&&!a&&{maxWidth:"calc(100% - 26px)"},...n&&{maxWidth:"160px"},...n&&a&&{maxWidth:"190px"},...n&&i&&{maxWidth:"400px"},...i&&("message_pinned"===r||"message_unpinned"===r)&&{maxWidth:"400px"}}));function N({msgId:e,authUser:t,showToolbar:n=!0,disableReact:r,handleAction:l}){let{jsxBackend:s,usePageParams:c,useGetItem:g}=(0,i.OgA)(),h=`chat.entities.message.${e}`,f=g(h),v=c(),y=(null==v?void 0:v.rid)||!1,[x]=(0,i.zXz)(h,{}),b=(0,d.PB)(),{id:w,type:E,attachments:P,reactions:k,created_at:C,user:Z}=f||{},M=g(Z),R=t.id===(null==M?void 0:M.id),A=(0,a.jF)(C),I=(0,a.qF)(P),S=(0,a.vS)(E),O=o.useMemo(()=>(0,p.W$)(b,{isSearch:!1,allowEdit:R,item:f,canDelete:R}),[b,!1,R,f,R]);if(!f)return null;let _=(e,t,n)=>{x(e,t,n),l(e,f,n)},F="messageDeleted"!==E;return o.createElement(D,{isOwner:R,"data-id":w,"data-t":E,"data-testid":w},o.createElement(H,{isOwner:R,isAlert:S,isShowReact:F},o.createElement(L,{hasToolbar:n,multiImage:I>1,isOwner:R,isPageAllMessages:y,msgType:E,className:(0,u.default)("uiChatMsgItemBodyOuter")},s.render({component:`chat.messageContent.${E}`,props:{message:f,isOwner:R,user:Z,createdDate:A,msgType:E,tooltipPosition:"top"}})),F&&!S&&o.createElement(W,{identity:h,handleAction:_,disabled:!n,disableReact:r,items:O,isOwner:R})),F&&o.createElement(m.Z,{identity:h,disabled:!k,reactions:k,isOwner:R,handleAction:_}))}let $="MsgSet",U=(0,l.ZP)("div",{name:$,slot:"uiChatMsgSet",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e})(({theme:e,isOwner:t,isAlert:n})=>({display:"flex",flexDirection:"row",padding:e.spacing(.5,2),...n&&{"&.uiChatMsgItemCall":{border:"none"},"&.uiChatMsgActions":{justifyContent:"center","&.my-1; .btn":{"&.mx-1":"!important"}}},...t&&{flexDirection:"row-reverse",padding:e.spacing(0,2)}})),Q=(0,l.ZP)("div",{name:$,slot:"uiChatMsgSetAvatar",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e})(({theme:e,isOwner:t,isAlert:n})=>({marginRight:e.spacing(1),display:"flex",alignItems:"flex-end",marginBottom:e.spacing(.75),...t&&{display:"none",flexDirection:"row-reverse"},...n&&{display:"none"},"& > span":{cursor:"default"}})),G=(0,l.ZP)("div",{name:$,slot:"uiChatMsgSetBody",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({flex:1,minWidth:0,...t&&{flexDirection:"row-reverse"}}));function Y({msgSet:e,disableReact:t,handleAction:n}){let{useSession:a,useGetItem:r}=(0,i.OgA)(),{user:l}=a(),s=r(null==e?void 0:e.user);if(!e)return;let{items:d}=e,m=l.id===s.id;return d&&d.length?o.createElement(U,{isOwner:m,className:`uiChatMsgSet ${m?"isOwner":""}`},o.createElement(Q,{isOwner:m,className:"uiChatMsgSetAvatar"},o.createElement(c.Z,{user:s,size:32})),o.createElement(G,{className:"uiChatMsgSetBody"},d.map((e,a)=>o.createElement(N,{authUser:l,key:e.toString(),msgId:e,disableReact:t,handleAction:n})))):null}function q({msgGroup:e,disableReact:t,handleAction:n}){if(!e)return null;let{items:a}=e;return a?o.createElement("div",null,a.map((e,a)=>o.createElement(Y,{msgSet:e,key:`k.0${a}`,disableReact:t,handleAction:n}))):null}var K=n(19382);let V=(0,l.ZP)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({"&:not(:first-of-type)":{marginTop:e.spacing(.75)},position:"relative",padding:e.spacing(1),maxWidth:"245px",backgroundColor:e.palette.grey["100"],..."dark"===e.palette.mode&&{backgroundColor:e.palette.grey["600"]},borderRadius:e.spacing(1.25),overflow:"hidden",...t&&{maxWidth:"400px",padding:e.spacing(1.25,1)}})),X=(0,l.ZP)("div")(({theme:e})=>({display:"flex",alignItems:"center","& .ico":{marginRight:e.spacing(.75)}})),J=(0,l.ZP)(g.Ys)(({theme:e})=>({flex:1,minWidth:0,fontSize:e.mixins.pxToRem(12)})),ee=(0,l.ZP)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({position:"absolute",bottom:0,left:0,right:0,padding:e.spacing(0,1),...t&&{span:{height:e.spacing(.75)}}}));var et=function({count:e=1,files:t,progress:n=0,isAllPage:a=!1}){let{i18n:r}=(0,i.OgA)();if(t||t.length)return o.createElement(V,{isAllPage:a},o.createElement(X,null,o.createElement(g.zb,{icon:"ico-paperclip-alt"}),o.createElement(J,{lines:1},1===e?o.createElement(o.Fragment,null,r.formatMessage({id:"uploading_name"},{name:t[0].name})):r.formatMessage({id:"uploading_n_attachments"},{count:e}))),o.createElement(ee,{isAllPage:a},o.createElement(K.Z,{variant:"determinate",value:n})))};function en(){return(en=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}let ea=(0,l.ZP)("div")(({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"flex-end",marginBottom:e.spacing(.5),padding:e.spacing(.5,2)})),ei=(0,l.ZP)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({display:"flex",flexDirection:"column",alignItems:"flex-end",width:"100%",...t&&{maxWidth:'calc(~"100% - 50px")'}}));var er=function({data:e,eventInit:t,isAllPage:n=!1}){let a=Object.keys(e),i=a.map(t=>{return{id:t,...e[t]}});return(o.useEffect(()=>{t&&t()},[i]),i.length)?o.createElement(ea,null,o.createElement(ei,{isAllPage:n},i.map(e=>o.createElement(et,en({},e,{key:e.id,isAllPage:n}))))):null},el=n(58668);let eo="MsgSet",es=(0,l.ZP)("div",{name:eo,slot:"uiChatMsgSet"})(({theme:e})=>({display:"flex",flexDirection:"row-reverse",padding:e.spacing(0,2),opacity:.6,pointerEvents:"none"})),ec=(0,l.ZP)("div",{name:eo,slot:"uiChatMsgSetBody",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({flex:1,minWidth:0,...t&&{flexDirection:"row-reverse"}})),ed=(0,l.ZP)("div",{name:eo,slot:"uiChatMsgItemMsg",shouldForwardProp:e=>"isOwner"!==e&&"isQuote"!==e})(({theme:e,isOwner:t,isQuote:n})=>({minHeight:e.spacing(5),marginBottom:e.spacing(.5),borderRadius:e.spacing(1),fontSize:e.mixins.pxToRem(15),padding:e.spacing(1.25),display:"flex",alignItems:"center",backgroundColor:e.palette.grey["100"],..."dark"===e.palette.mode&&{backgroundColor:e.palette.grey["600"]},overflowWrap:"break-word","& a":{color:t?"#fff":e.palette.text.primary,textDecoration:"underline",cursor:"pointer",overflowWrap:"break-word"},...t&&{backgroundColor:e.palette.primary.main,color:"#fff !important"}})),em=(0,l.ZP)("div",{name:eo,slot:"uiChatMsgItemBodyInnerWrapper"})(({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"flex-end"}));function ep({item:e}){return e.text||e.dataQuote?o.createElement(es,null,o.createElement(ec,null,o.createElement(em,null,M()(e.dataQuote)?null:o.createElement(el.Z,{dataQuote:e.dataQuote,isOwner:!0}),e.text?o.createElement(ed,{isQuote:!1,isOwner:!0,className:"uiChatMsgItemMsg",dangerouslySetInnerHTML:{__html:e.text}}):null))):null}let eu=(0,l.ZP)(r.Z,{name:"Messages",slot:"DateTimeGroup"})(({theme:e})=>({textAlign:"center",color:e.palette.grey["600"],padding:e.spacing(1,0)}));var eg=o.forwardRef(function({rid:e,groups:t,groupIds:n,preFetchingMsg:r,newest:l,disableReact:c,room:d,containerRef:m,handleAction:p,isAllPage:u,roomProgress:g,loading:h},f){let v=(0,i.lJz)(),[y,x]=o.useState(!1),b=()=>{let e=v.current.scrollHeight+0;v.current.scrollTo({top:e})};return(o.useEffect(()=>{y&&setTimeout(()=>{b()},100)},[e,y,h]),o.useEffect(()=>{return x(!!(null==n?void 0:n.length)),()=>x(!1)},[null==n?void 0:n.length]),o.useLayoutEffect(()=>{if((null==v?void 0:v.current)&&l){let e=v.current;e.scrollHeight-e.scrollTop-110<=e.clientHeight&&b()}},[l]),o.useImperativeHandle(f,()=>{return{scrollToBottom:()=>{b()}}}),d&&t)?o.createElement(s.Provider,{value:m},n.map((e,n)=>{var i,r;return o.createElement("div",{key:`k.0${n}`},t[e]&&(0,a.jF)(null===(i=t[e])||void 0===i?void 0:i.ts)?o.createElement(eu,null,(0,a.jF)(null===(r=t[e])||void 0===r?void 0:r.ts)):null,o.createElement(q,{msgGroup:t[e],disableReact:c,handleAction:p}))}),M()(g)?null:o.createElement(er,{data:g,eventInit:b,isAllPage:u}),r?r.filter(e=>{return(null==e?void 0:e.isLoading)===!0}).map(e=>o.createElement(ep,{key:e,item:e})):null):null})},62335:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var a=n(81719),i=n(42097),r=n(67294);let l=(0,a.ZP)("div",{name:"MsgAttachment",slot:"UIMsgAttachment",shouldForwardProp:e=>"isOwner"!==e&&"isAudio"!==e&&"isTypeFile"!==e&&"isOther"!==e})(({theme:e})=>({maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",marginBottom:e.spacing(.5),marginTop:e.spacing(.25),overflow:"hidden"}));function o({item:e,isOwner:t}){let{is_image:n,image:a,file_name:o,download_url:s,file_size_text:c}=e;return r.createElement(l,{isOwner:t},r.createElement(i.Z,{isOwner:t,image:a,is_image:n,download_url:s,file_name:o,file_size_text:c}))}},42097:function(e,t,n){"use strict";n.d(t,{Z:function(){return P}});var a=n(2475),i=n(81719),r=n(67294),l=n(85597),o=n(27274);let s="MsgAttachmentImage",c=(0,i.ZP)("div",{name:s})(({theme:e})=>({position:"relative",width:"100%"})),d=(0,i.ZP)("figure",{name:s})(({theme:e})=>({margin:0,display:"block"})),m=(0,i.ZP)("div",{name:s,shouldForwardProp:e=>"isOwner"!==e&&"isPageAllMessages"!==e})(({theme:e,isOwner:t,isPageAllMessages:n})=>({width:"144px",maxWidth:"100%",cursor:"pointer",...t&&{width:"186px"},...n&&{width:"300px"}})),p=(0,i.ZP)("img",{name:s})(({theme:e})=>({position:"absolute",left:0,top:0,width:"100%",borderRadius:e.spacing(1)})),u=(e,t)=>{let n=new Image;n.src=t,n.onload=()=>{e({height:n.height,width:n.width})},n.onerror=t=>{e(t)}};function g({isOwner:e,image:t,download_url:n,file_name:a}){let{dispatch:i,usePageParams:s,assetUrl:g}=(0,l.OgA)(),h=s(),f=(null==h?void 0:h.rid)||!1,[v,y]=r.useState(null),x=(0,o.Q4)(t,"240",g("photo.no_image")),b=(0,o.Q4)(t,"origin",g("photo.no_image"));r.useEffect(()=>{x&&u(y,x)},[x]);let w=!!v&&v.height/v.width,E=()=>{i({type:"chat/room/presentImageView",payload:{image:{id:"img0",src:b,download_url:n,is_image:!0,file_name:a}}})};return r.createElement(c,{className:"uiMsgAttachmentImgWrapper"},r.createElement(d,null,r.createElement(m,{isOwner:!!e,isPageAllMessages:f,style:{paddingBottom:`${w?100*w:100}%`}},r.createElement(p,{src:x,onClick:E,alt:a}))))}let h="MsgAttachmentImage",f=(0,i.ZP)("div",{name:h,slot:"UIMsgAttachmentImgWrapper"})(({theme:e})=>({position:"relative",width:"100%"})),v=(0,i.ZP)("figure",{name:h})(({theme:e})=>({margin:0,display:"block"})),y=(0,i.ZP)("div",{name:h,shouldForwardProp:e=>"isOwner"!==e&&"isPageAllMessages"!==e&&"typeGridLayout"!==e})(({theme:e,isOwner:t,isPageAllMessages:n,typeGridLayout:a})=>({width:"94px",height:"94px",maxWidth:"100%",cursor:"pointer",marginBottom:"1px",..."type-2"===a&&!t&&{width:"72px",height:"72px"},..."type-1"===a&&{width:"52px",height:"52px"},..."type-1"===a&&t&&{width:"62px",height:"62px"},...n&&"type-2"===a&&{width:"190px",height:"190px"},...n&&"type-1"===a&&{width:"126px",height:"126px"}})),x=(0,i.ZP)("img",{name:h,shouldForwardProp:e=>"typeGridLayout"!==e})(({theme:e,typeGridLayout:t})=>({position:"absolute",left:0,top:0,width:"100%",objectFit:"cover",borderRadius:e.spacing(1),...t&&{width:"98%",height:"98%"}}));function b({image:e,download_url:t,images:n,typeGridLayout:a,isOwner:i,file_name:s,keyIndex:c}){let{dispatch:d,usePageParams:m,assetUrl:p}=(0,l.OgA)(),u=m(),g=(null==u?void 0:u.rid)||!1,h=r.useMemo(()=>{return n&&n.length?n.map((e,t)=>{let n=(0,o.Q4)(e.image,"origin",p("photo.no_image"));return{id:t,src:n,download_url:e.download_url,file_name:e.file_name}}):[]},[n]),b=(0,o.Q4)(e,"500",p("photo.no_image")),w=(0,o.Q4)(e,"origin",p("photo.no_image")),E=()=>{d({type:"chat/room/presentImageView",payload:{image:{id:parseInt(c),src:w,download_url:t,file_name:s},images:h}})};return r.createElement(f,null,r.createElement(v,null,r.createElement(y,{isOwner:!!i,isPageAllMessages:g,typeGridLayout:a},r.createElement(x,{typeGridLayout:a,src:b,onClick:E,alt:"dwq"}))))}let w=(0,i.ZP)("div",{name:"MsgAttachmentMedia",slot:"TitleLink",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({borderRadius:e.spacing(1),fontSize:e.spacing(1.75),padding:e.spacing(1),overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",display:"inline-block",maxWidth:"100%",wordBreak:"break-word",wordWrap:"break-word",backgroundColor:e.palette.grey["100"],..."dark"===e.palette.mode&&{backgroundColor:e.palette.grey["600"]},...t&&{backgroundColor:e.palette.primary.main,color:"#fff"}})),E=(0,i.ZP)("div")(({theme:e})=>({display:"flex",alignItems:"center",cursor:"pointer","& .ico":{marginRight:e.spacing(1)}}));function P({isOwner:e,layout:t,totalImages:n,typeGridLayout:i,is_image:l,image:o,file_name:s,download_url:c,file_size_text:d,keyIndex:m}){return o&&"multi-image"===t?r.createElement(b,{images:n,file_name:s,image:o,download_url:c,isOwner:e,typeGridLayout:i,keyIndex:m}):l&&o?r.createElement(g,{isOwner:e,image:o,file_name:s,download_url:c}):l?null:r.createElement(w,{isOwner:e},r.createElement(E,{onClick:()=>(0,a.Sv)(c)},r.createElement("i",{className:"ico ico-arrow-down-circle mr-1"}),s))}},82353:function(e,t,n){"use strict";n.d(t,{Z:function(){return g},C:function(){return u}});var a=n(85597),i=n(67294),r=n(62335),l=n(81719),o=n(42097);function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}let c="MsgAttachmentMultiMedia",d=(0,l.ZP)("div",{name:c,slot:"uiMsgImageAttachmentWrapper",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",alignItems:"center",flexWrap:"wrap",justifyContent:t?"flex-end":"flex-start",marginTop:e.spacing(.25)})),m=(0,l.ZP)("div",{name:c,slot:"uiMsgImageAttachmentItem",shouldForwardProp:e=>"typeGridLayout"!==e&&"isPageAllMessages"!==e&&"isLastItem"!==e})(({theme:e,typeGridLayout:t,isPageAllMessages:n,isLastItem:a})=>({..."type-1"===t&&{flexBasis:"33.333333%"},..."type-2"===t&&{flexBasis:"50%"}}));function p({mediaItems:e,isOwner:t}){let{usePageParams:n}=(0,a.OgA)(),r=n(),l=(null==r?void 0:r.rid)||!1,c=e.length,p=c%3==0?"type-1":c%3==1?"type-1":"type-2";return i.createElement(d,{isOwner:t},e.map((n,a)=>i.createElement(m,{typeGridLayout:p,isPageAllMessages:l,isLastItem:a===e.length-1,key:`k${a}`},i.createElement(o.Z,s({},n,{keyIndex:a,layout:"multi-image",totalImages:e,typeGridLayout:p,isOwner:t})))))}let u=e=>{let{useGetItem:t}=(0,a.OgA)(),n=e.map(e=>{if("string"!=typeof e)return e;{let n=t(e);return n}}),i=[],r=[];return n.map(e=>{e.is_image?i.push(e):r.push(e)}),{multiImageFile:i,otherFile:r,attachments:n}};function g({message:e,isOwner:t}){var n;let{multiImageFile:a,otherFile:l,attachments:o}=u(null==e?void 0:e.attachments);return(null===(n=e.attachments)||void 0===n?void 0:n.length)&&(a.length||l.length)?a.length>1?i.createElement(i.Fragment,null,i.createElement(p,{mediaItems:a,isOwner:t}),l.length?l.map((e,n)=>i.createElement(r.Z,{item:e,key:`k${n}`,isOwner:t})):null):o.map((e,n)=>i.createElement(r.Z,{item:e,key:`k${n}`,isOwner:t})):null}},58668:function(e,t,n){"use strict";n.d(t,{Z:function(){return P}});var a=n(40263),i=n(85597),r=n(30120),l=n(81719),o=n(91647),s=n(67294),c=n(16473),d=n(82353),m=n(62335);let p="MsgAttachment",u=(0,l.ZP)("div",{name:p,slot:"UIMsgAttachment",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({marginBottom:e.spacing(-2),marginLeft:e.spacing(1),marginRight:0,marginTop:e.spacing(.25),paddingBottom:e.spacing(3),maxWidth:"calc(100% - 8px)",display:"flex",flexDirection:"row",overflow:"hidden",border:e.mixins.border("secondary"),borderRadius:e.spacing(1),minHeight:"70px","& a:not(.MuiAvatar-root)":{color:e.palette.text.primary,textDecoration:"underline",cursor:"pointer"},...t&&{color:e.palette.text.secondary,marginRight:e.spacing(1),marginLeft:0}})),g=(0,l.ZP)("div",{name:p,slot:"Author"})(({theme:e})=>({display:"flex",justifyContent:"flex-start",alignItems:"center","& .MuiAvatar-root":{fontSize:e.mixins.pxToRem(7)},strong:{padding:e.spacing(0,.5)}})),h=(0,l.ZP)("div",{name:p,slot:"MsgAttachmentFlex"})(({theme:e})=>({textAlign:"start"})),f=(0,l.ZP)(c.Ys,{name:p,slot:"Text"})(({theme:e})=>({color:e.palette.text.secondary,margin:e.spacing(.5,0)})),v=(0,l.ZP)("div",{name:p,slot:"TextDelete"})(({theme:e})=>({margin:e.spacing(.5),marginLeft:0,fontStyle:"italic"})),y=(0,l.ZP)("div",{name:p,slot:"AttachmentInfo"})(({theme:e})=>({overflow:"hidden",margin:e.spacing(1,1,0,0)})),x=(0,l.ZP)("div")(({theme:e})=>({width:e.spacing(.5),height:"100%",backgroundColor:e.palette.grey["100"]})),b=(0,l.ZP)("div")(({theme:e})=>({width:e.spacing(3),minWidth:e.spacing(3),marginTop:e.spacing(1.5),display:"flex",justifyContent:"center",alignItems:"center"})),w=(0,l.ZP)(o.Z)(({theme:e})=>({color:"light"===e.palette.mode?e.palette.grey.A200:e.palette.text.primary})),E=(0,l.ZP)(c.Ys,{name:p,slot:"uiMsgAttachmentLink"})(({theme:e})=>({"& .ico":{fontSize:e.mixins.pxToRem(12),marginRight:e.spacing(.5)}}));function P({dataQuote:e,isOwner:t}){var n;let{i18n:l}=(0,i.OgA)(),{type:o,user:p,message:P}=e,{multiImageFile:k,otherFile:C,attachments:Z}=(0,d.C)(null==e?void 0:e.attachments);return s.createElement(u,{isOwner:t},s.createElement(b,null,s.createElement(x,null)),s.createElement(y,null,p?s.createElement(g,null,s.createElement(w,{component:"h2",variant:"h5"},p.full_name||p.user_name)):null,s.createElement(h,null,"messageDeleted"===o?s.createElement(v,null,l.formatMessage({id:"message_was_deleted"})):null,P&&"messageDeleted"!==o?s.createElement(f,{lines:1,dangerouslySetInnerHTML:{__html:(0,a.ZP)(P)}}):null,P||(null===(n=e.attachments)||void 0===n||!n.length)&&(k.length||C.length)?null:s.createElement(r.Z,{sx:{mt:1}},k.length>1?s.createElement(f,{lines:1},l.formatMessage({id:"total_photo"},{value:k.length})):s.createElement(s.Fragment,null,Z.map((e,n)=>s.createElement(s.Fragment,{key:`k${n}`},e.is_image&&e.image?s.createElement(m.Z,{item:e,isOwner:t}):s.createElement(E,{lines:1},s.createElement(c.zb,{icon:"ico-paperclip-alt"}),e.file_name))))))))}},27937:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var a=n(85597),i=n(81719),r=n(67294),l=n(40471),o=n(47037),s=n.n(o);let c=(0,i.ZP)("span")(({theme:e})=>({display:"inline-flex",alignItems:"center",justifyContent:"center",margin:e.spacing(0,.25)})),d=(0,i.ZP)("img")(({theme:e})=>({width:15,height:15}));function m({id:e,users:t=[]}){let n=(0,l.z)();if(!e||!t.length)return null;let a=s()(e)&&e.split(":")[1].split("_")[1];if(!a||!n)return null;let i=n.find(e=>e.id===parseInt(a));return r.createElement(c,null,r.createElement(d,{src:null==i?void 0:i.src,draggable:!1,alt:null==i?void 0:i.title}))}let p=(0,i.ZP)("div",{shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",margin:0,padding:0,marginBottom:e.spacing(-.25),...t&&{flexDirection:"row-reverse"}})),u=(0,i.ZP)("span")(({theme:e})=>({marginLeft:e.spacing(.5),position:"relative",top:"-1px",fontSize:e.typography.pxToRem(14),height:e.spacing(2.5),fontWeight:e.typography.fontWeightRegular})),g=(0,i.ZP)("div")(({theme:e})=>({cursor:"pointer",color:e.palette.grey["800"],backgroundColor:e.palette.grey["50"],position:"relative",borderRadius:e.spacing(1),lineHeight:e.spacing(2.5),whiteSpace:"nowrap",display:"inline-flex",alignItems:"center",padding:e.spacing(.5,.75),boxShadow:"0px 0px 15px 0px #00000026",transform:"translateY(-10px)",height:e.spacing(3),zIndex:2}));function h({identity:e,disabled:t,reactions:n,isOwner:i,handleAction:l}){let{dispatch:o}=(0,a.OgA)(),s=()=>{o({type:"chat/presentReactionsList",payload:{identity:e}})};if(t||!n||!Object.keys(n).length)return null;let c=0,d=Object.keys(n).reduce((e,t)=>{var a;return c+=null===(a=n[t])||void 0===a?void 0:a.length,{...e,[t]:n[t]}},{});return r.createElement(p,{isOwner:i},r.createElement(g,{onClick:s},Object.keys(d).slice(0,3).map((e,t)=>r.createElement(m,{id:e,users:d[e],key:`k${t}`})),r.createElement(u,null,c)))}},40471:function(e,t,n){"use strict";n.d(t,{z:function(){return l}});var a=n(86706),i=n(22222);let r=(0,i.P1)(e=>e.preaction.data.reactions,e=>e);function l(){return(0,a.v9)(r)}}}]);