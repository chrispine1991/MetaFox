"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-music-blocks-SongDetail-Block"],{47071:function(e,t,a){a.r(t),a.d(t,{default:function(){return E}});var n=a(85597),i=a(10316),r=a(84116),l=a(21241),o=a(16473),c=a(30120),s=a(81719),m=a(67294),u=a(47951),d=a(22410),p=a(73327);let g=(0,d.Z)(e=>(0,p.Z)({root:{},bgCoverWrapper:{height:320,overflow:"hidden",position:"relative"},bgCover:{height:"100%",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover",filter:"brightness(0.45) blur(50px)",position:"absolute",left:0,right:0,top:0,bottom:0,zIndex:-2,"&::after":{content:'""',position:"absolute",left:0,right:0,top:0,bottom:0,zIndex:-1,background:"#000",opacity:.1}},hasBgCover:{},header:{marginLeft:e.spacing(2),marginRight:"auto",color:"#fff",paddingTop:e.spacing(4),display:"flex",justifyContent:"space-between"},headerInner:{flex:1,minWidth:0,margin:e.spacing(0,3,0,2),display:"flex",flexDirection:"column"},imgSong:{width:212,height:212},viewContainer:{margin:e.spacing(0,2,0,2),borderRadius:8,backgroundColor:e.mixins.backgroundColor("paper"),border:e.mixins.border("secondary"),padding:e.spacing(0,2,2,2),position:"relative","&$hasBgCover":{marginTop:-44}},actionMenu:{width:32,height:32,position:"absolute !important",top:e.spacing(1),right:e.spacing(1),"& .ico":{color:e.palette.text.secondary,fontSize:13}},titleWrapper:{display:"flex"},pageTitle:{margin:e.spacing(1.5,0,1.25,.5),fontWeight:e.typography.fontWeightSemiBold,minWidth:0,fontSize:e.spacing(3),lineHeight:1.3,maxHeight:72,overflow:"hidden",textOverflow:"ellipsis",wordBreak:"break-word",wordWrap:"break-word",whiteSpace:"normal",WebkitLineClamp:1,display:"-webkit-box",WebkitBoxOrient:"vertical","& .ico-heart":{color:e.palette.primary.main}},itemFlag:{"& > div:last-child":{marginRight:e.spacing(1)}},minorInfo:{marginTop:e.spacing(1),color:e.palette.text.hint,fontSize:13,fontWeight:e.typography.fontWeightBold},soundWave:{marginTop:"auto"},author:{display:"flex",marginTop:e.spacing(2)},authorInfo:{marginLeft:e.spacing(1.5)},userName:{fontSize:15,fontWeight:"bold",color:e.palette.text.primary,paddingRight:e.spacing(.5)},date:{fontSize:13,color:e.palette.text.secondary,marginTop:e.spacing(.5)},itemContent:{fontSize:15,lineHeight:1.33,marginTop:e.spacing(3),"& p + p":{marginBottom:e.spacing(2.5)}},songAlbum:{display:"flex",fontWeight:e.typography.fontWeightSemiBold,marginTop:1.5},album:{fontWeight:"normal",color:e.palette.text.hint}}),{name:"MuiSongViewDetail"});var f=a(7390),h=a(43847);let v=(0,s.ZP)("span",{name:"HeadlineSpan"})(({theme:e})=>({paddingRight:e.spacing(.5),color:e.palette.text.secondary})),b=(0,s.ZP)(h.Z,{name:"OwnerStyled"})(({theme:e})=>({fontWeight:e.typography.fontWeightBold,color:e.palette.text.primary,fontSize:e.mixins.pxToRem(15),"&:hover":{textDecoration:"underline"}})),y=(0,n.Uh$)((0,i.ZP)(function({item:e,user:t,blockProps:a,identity:i,handleAction:s,state:d}){let{ItemActionMenu:p,ItemDetailInteraction:h,i18n:y,assetUrl:E,jsxBackend:x,getSetting:S}=(0,n.OgA)(),C=g(),w=(0,n.z88)(null==e?void 0:e.genres[0]),N=S("music.music_song.auto_play"),k=(0,n.z88)(null==e?void 0:e.album),W=(0,n.z88)(null==e?void 0:e.owner);if(!e)return null;let{creation_date:z,description:_,name:Z,statistic:I,destination:P,is_featured:M,is_sponsor:T,resource_name:R,image:$}=e,B=x.get("core.itemView.pendingReviewCard"),A=(null==$?void 0:$.origin)||E("music.song_no_image");return m.createElement(l.gO,{testid:`detailview ${R}`},m.createElement(l.sU,null,m.createElement("div",{className:C.root},m.createElement("div",{className:C.bgCoverWrapper},m.createElement("div",{className:C.bgCover,style:{backgroundImage:`url(${A})`}}),m.createElement("div",{className:C.header},m.createElement(o.Gy,{src:A,className:C.imgSong,aspectRatio:"11"}),m.createElement("div",{className:C.headerInner},m.createElement("div",{className:C.titleWrapper},m.createElement("div",{className:C.itemFlag},m.createElement(o.K6,{variant:"itemView",value:M}),m.createElement(o.k5,{variant:"itemView",value:T}))),m.createElement(c.Z,{className:C.pageTitle},Z),m.createElement(c.Z,{className:C.songAlbum},m.createElement(n.rUS,{to:null==w?void 0:w.url},null==w?void 0:w.name),k&&m.createElement(m.Fragment,null,m.createElement(c.Z,{ml:.5,mr:.5},"â€¢"),m.createElement(c.Z,{mr:.5,className:C.album},y.formatMessage({id:"album"})),m.createElement(n.rUS,{to:(null==k?void 0:k.link)||(null==k?void 0:k.url)},null==k?void 0:k.name))),Number.isInteger(null==I?void 0:I.total_play)?m.createElement("div",{className:C.minorInfo},y.formatMessage({id:"value_plays"},{value:I.total_play})):null,m.createElement("div",{className:C.soundWave},P&&m.createElement(u.Z,{autoPlay:N,url:P,isPlaylist:!1,selectedSong:e}))))),m.createElement("div",{className:`${C.viewContainer} ${C.hasBgCover}`},m.createElement(p,{identity:i,icon:"ico-dottedmore-vertical-o",state:d,handleAction:s,className:C.actionMenu}),m.createElement("div",{className:C.author},m.createElement(c.Z,{component:"div"},m.createElement(o.Yt,{user:t,size:48})),m.createElement("div",{className:C.authorInfo},m.createElement(n.rUS,{color:"inherit",to:`/user/${null==t?void 0:t.id}`,children:t.full_name,className:C.userName}),(null==W?void 0:W.resource_name)!==(null==t?void 0:t.resource_name)&&m.createElement(v,null,y.formatMessage({id:"to_parent_user"},{icon:()=>m.createElement(o.zb,{icon:"ico-caret-right"}),parent_user:()=>m.createElement(b,{user:W})})),m.createElement(o.Ee,{sx:{color:"text.secondary",mt:.5}},m.createElement(o.r2,{value:z,format:"MMMM DD, yyyy"}),m.createElement(o.Cd,{value:null==e?void 0:e.privacy,item:null==e?void 0:e.privacy_detail})))),m.createElement(c.Z,{mt:2},m.createElement(B,{item:e})),_&&m.createElement(c.Z,{component:"div",mt:3,className:C.itemContent},m.createElement(r.ZP,{html:_})),m.createElement(f.Z,{attachments:null==e?void 0:e.attachments,size:"large"}),m.createElement(h,{identity:i,handleAction:s})))))}));var E=(0,n.j4Z)({extendBlock:y,defaults:{placeholder:"Search",blockProps:{variant:"plained",titleComponent:"h2",titleVariant:"subtitle1",titleColor:"textPrimary",noFooter:!0,noHeader:!0,blockStyle:{},contentStyle:{borderRadius:"base"},headerStyle:{},footerStyle:{}}}})},47951:function(e,t,a){a.d(t,{Z:function(){return E}});var n=a(16473),i=a(19382),r=a(763),l=a(30120),o=a(38790),c=a(22410),s=a(73327),m=a(67294),u=a(21796),d=a.n(u),p=a(85597),g=a(86706),f=a(86010),h=a(10928),v=a.n(h);let b=(0,c.Z)(e=>(0,s.Z)({root:{display:"flex",alignItems:"flex-end","& .ico":{color:"#fff",fontSize:18,cursor:"pointer"}},waveForm:{margin:e.spacing(0,1,1),height:77,overflow:"hidden",flex:1,position:"relative","&::before":{content:"''",height:"2px",background:"#eee",width:"100%",position:"absolute",bottom:0},"& wave > wave::before":{content:"''",position:"absolute",top:"50%",height:"2px",width:"100%",background:"#2682d5"}},btnControlWrapper:{marginRight:e.spacing(2)},btnControl:{border:"none",background:"transparent",outline:"none",padding:0,"& + $btnControl":{paddingLeft:e.spacing(2)}},btnPlayPause:{},btnShuffle:{marginLeft:e.spacing(2)},btnRepeat:{marginLeft:e.spacing(2)},activeIcon:{color:`${e.palette.primary.main} !important`},timePlaying:{minWidth:e.spacing(5),textAlign:"right",fontSize:15},timeSong:{fontSize:15},volumeWrapper:{width:e.spacing(2),position:"relative",marginLeft:e.spacing(1.5),"&:hover $volumeSlider":{visibility:"visible",opacity:1}},volumeSlider:{height:70,visibility:"hidden",opacity:0,transition:"all 300ms ease",position:"absolute",left:e.spacing(-.5),bottom:e.spacing(4.5)},volumeSliderItem:{color:"#fff","& .MuiSlider-thumb":{width:"15px",height:"15px",boxShadow:"none !important",color:"#fff"}},progress:{flex:1,margin:e.spacing(0,1,1),position:"absolute",bottom:0},hide:{display:"none!important"},visibility:{visibility:"hidden"},disabledIcon:{color:`${e.palette.grey[500]}!important`}}),{name:"Waveform"}),y=e=>({container:e,waveColor:"#eee",progressColor:"#2682d5",cursorColor:"transparent",barWidth:3,barHeight:2,barRadius:0,barGap:2,responsive:!0,height:150,loopSelection:!0,normalize:!0,partialRender:!0,minPxPerSec:100});function E({url:e,isPlaylist:t,isPlaying:a,setIsPlaying:c,songs:s,selectedSong:u,setSelectedSong:h,orderPlay:E,setOrderPlay:x,autoPlay:S}){let C=new AudioContext,w=b(),N=(0,m.useRef)(null),k=(0,m.useRef)(null),[W,z]=(0,m.useState)(!1),[_,Z]=(0,m.useState)(!1),[I,P]=(0,m.useState)(!1),[M,T]=(0,m.useState)("0:00"),[R,$]=(0,m.useState)("0:00"),[B,A]=(0,m.useState)(.5),[F,L]=(0,m.useState)(!1),[D,V]=(0,m.useState)(!1),{dispatch:H,useLoggedIn:O,i18n:U}=(0,p.OgA)(),j=(0,g.v9)(e=>(0,p.Flc)(e,s)),G=O();(0,m.useEffect)(()=>{z(!1),V(!1);let n=y(N.current);if(k.current=d().create(n),e)return k.current.load(e),k.current.on("ready",()=>{if(V(!0),"running"===C.state&&!t&&S&&(k.current.play(),z(!0)),t){c(e=>{return e&&k.current.play(),e}),k.current.setVolume(B),A(B);let e=X(k.current.getDuration());$(e)}}),k.current.on("audioprocess",()=>{let e=X(k.current.getCurrentTime());T(e)}),k.current.on("seek",e=>{let t=X(k.current.getCurrentTime());T(t)}),k.current.on("finish",()=>{Y(),P(e=>{return e?(k.current.play(),t?c(!a):z(!W)):(L(e=>{return t&&et(1),e}),z(!1)),e})}),()=>k.current.destroy()},[e]);let X=e=>{let t=Math.floor(e/60),a=`0${Math.floor(e-60*t)}`.slice(-2);return`${t}:${a}`},K=()=>{t?c(!a):z(!W),k.current.playPause()},Y=()=>{if(!G)return;let e=null==u?void 0:u._identity;H({type:"music/updateTotalPlayItem",payload:{identity:e}})},q=(e,t)=>{k.current.setVolume(t),A(t),0===t?Z(!0):Z(!1)},J=()=>{k.current.setVolume(_?B:0),Z(e=>!e)},Q=()=>{P(!I)},ee=()=>{L(!F),x(e=>{return e.sort((e,t)=>.5-Math.random())})},et=e=>{c(!0);let t=j.findIndex(e=>{return(null==e?void 0:e.id)===(null==u?void 0:u.id)}),a=E.findIndex(e=>t===e);L(n=>{return n?a+e===E.length?h(j[E[0]]):h(j[E[a+e]]):t+e===E.length?h(j[0]):t+e<0?h(v()(j)):h(j[t+e]),n})};return m.createElement("div",{className:w.root},m.createElement("div",{className:w.btnControlWrapper},t?m.createElement("button",{className:w.btnControl,onClick:()=>et(-1)},m.createElement(n.zb,{icon:"ico-play-prev"})):null,m.createElement("button",{onClick:K,className:(0,f.default)(w.btnControl,w.btnPlayPause),disabled:!D},(t?a:W)?m.createElement(n.zb,{icon:"ico-pause"}):m.createElement(n.zb,{icon:"ico-play",className:!D&&w.disabledIcon})),t?m.createElement("button",{className:w.btnControl,onClick:()=>et(1)},m.createElement(n.zb,{icon:"ico-play-next"})):null),m.createElement("div",{className:w.timePlaying},M),m.createElement(l.Z,{position:"relative",flex:1},m.createElement("div",{ref:N,className:(0,f.default)(w.waveForm,!D&&w.visibility)}),m.createElement(i.Z,{color:"inherit",className:(0,f.default)(D&&w.hide,w.progress)})),m.createElement("div",{className:w.timeSong},R),t?m.createElement(o.Z,{title:U.formatMessage({id:F?"turn_off_shuffle":"turn_on_shuffle"})},m.createElement(n.zb,{icon:"ico-shuffle",className:`${w.btnShuffle} ${F?w.activeIcon:""}`,onClick:ee})):null,m.createElement(o.Z,{title:U.formatMessage({id:I?"turn_off_repeat":"turn_on_repeat"})},m.createElement(n.zb,{icon:"ico-play-repeat",className:(0,f.default)(w.btnRepeat,I&&w.activeIcon,!D&&w.disabledIcon),onClick:Q})),m.createElement("div",{className:w.volumeWrapper},_?m.createElement(n.zb,{icon:"ico-volume-del",onClick:J,className:!D&&w.disabledIcon}):m.createElement(n.zb,{icon:"ico-volume-increase",onClick:J,className:!D&&w.disabledIcon}),m.createElement("div",{className:w.volumeSlider},D&&m.createElement(r.ZP,{orientation:"vertical",value:_?0:B,min:0,max:1,step:.01,onChange:q,"aria-labelledby":"vertical-slider",valueLabelDisplay:"auto",valueLabelFormat:e=>Math.round(100*e),className:w.volumeSliderItem}))))}},7390:function(e,t,a){var n=a(85597),i=a(16473),r=a(81719),l=a(67294);let o=(0,r.ZP)("div",{name:"attachmentTitle"})(({theme:e})=>({fontSize:e.mixins.pxToRem(18),marginTop:e.spacing(2),color:e.palette.text.secondary,fontWeight:e.typography.fontWeightBold})),c=(0,r.ZP)("div",{name:"attachment"})(({theme:e})=>({width:"100%",display:"flex",flexWrap:"wrap",justifyContent:"space-between"})),s=(0,r.ZP)("div",{name:"attachmentItemWrapper"})(({theme:e})=>({marginTop:e.spacing(2),flexGrow:0,flexShrink:0,flexBasis:"calc(50% - 8px)",minWidth:300})),m=({attachments:e,size:t})=>{let{i18n:a}=(0,n.OgA)(),r=(0,n.mbX)(e);return r.length?l.createElement(l.Fragment,null,l.createElement(o,null,a.formatMessage({id:"attachments"})),l.createElement(c,null,r.map(e=>{return l.createElement(s,{key:e.id.toString()},l.createElement(i.M$,{fileName:e.file_name,downloadUrl:e.download_url,isImage:e.is_image,fileSizeText:e.file_size_text,size:t,image:null==e?void 0:e.image}))}))):null};t.Z=m},10316:function(e,t,a){a.d(t,{ZP:function(){return c}});var n=a(85597),i=a(27361),r=a.n(i);let l=(0,n.rMH)({},()=>({})),o=(0,n.$jX)(function(e,t){let a=r()(e,t.identity);if(!a)return{};let n=a.songs?a.songs.map(t=>r()(e,t)).filter(Boolean):[];return{item:a,songs:n,user:r()(e,a.user)}});function c(e){return o(l(e))}}}]);