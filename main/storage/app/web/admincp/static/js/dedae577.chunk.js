"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-livestreaming-blocks-LiveComment-Block","metafox-livestreaming-blocks-LiveComment-CommentContainer"],{78622:function(e,t,n){n.r(t),n.d(t,{default:function(){return s}});var l=n(85597),o=n(21241),i=n(67294),r=n(90643),a=n(30120),m=(0,l.SuR)(function({item:e,identity:t,handleAction:n,state:m,title:c}){let{i18n:s,jsxBackend:d}=(0,l.OgA)(),u=d.get("CommentComposer"),v=d.get("livestreaming.ui.composerReplyInfo"),[p,f]=i.useState(),g=i.useRef();if(!e)return null;let{extra:E}=e,x=()=>{var e,t;if(!(null==g?void 0:g.current))return;let n=(null===(e=g.current)||void 0===e?void 0:e.scrollHeight)+0;null===(t=g.current)||void 0===t||t.scrollTo({top:n})},y=()=>{f(void 0)},b=()=>{f(void 0)};return i.createElement(o.gO,{testid:`detailview ${e.resource_name}`},i.createElement(o.ti,{title:s.formatMessage({id:c})}),i.createElement(o.sU,null,i.createElement(a.Z,{sx:{display:"flex",flexDirection:"column",height:"100%"}},i.createElement(a.Z,{sx:{flex:1,minHeight:0}},i.createElement(o.l$,{autoHide:!0,autoHeight:!0,autoHeightMax:"100%",ref:g},i.createElement(a.Z,{px:2,pb:2},i.createElement(r.default,{identity:t,scrollToBottom:x,streamKey:null==e?void 0:e.stream_key,setParentReply:f})))),(null==E?void 0:E.can_comment)?i.createElement(a.Z,{px:2},p?i.createElement(v,{item:p,removeReply:b}):null,i.createElement(u,{open:!0,identity:(null==p?void 0:p.parent_comment_identity)||t,onSuccess:y})):null)))});let c=(0,l.Uh$)(m);var s=(0,l.j4Z)({extendBlock:c,defaults:{blockLayout:"LiveStreaming Comment"}})},90643:function(e,t,n){n.r(t),n.d(t,{default:function(){return b}});var l=n(85597),o=n(67294),i=n(81719),r=n(16473),a=n(30120),m=n(30665);let c="PreFetchComment",s=(0,i.ZP)("div",{name:c,slot:"itemOuter"})(({theme:e})=>({display:"flex",opacity:.6,pointerEvents:"none","&:hover $ItemActionMenu":{visibility:"visible",marginLeft:e.spacing(.5)}})),d=(0,i.ZP)("div",{name:c,slot:"avatarWrapper"})(({theme:e})=>({marginRight:e.spacing(1)})),u=(0,i.ZP)("div",{name:c,slot:"itemInner"})(({theme:e})=>({display:"flex",flexDirection:"column",minWidth:0,wordBreak:"break-word"})),v=(0,i.ZP)("div",{name:c,slot:"itemName"})(({theme:e})=>({display:"flex",fontSize:e.mixins.pxToRem(13),marginBottom:e.spacing(.5)})),p=(0,i.ZP)(l.rUS,{name:c,slot:"userName"})(({theme:e})=>({fontSize:e.mixins.pxToRem(13),maxWidth:"100%",fontWeight:"bold"})),f=(0,i.ZP)("div",{name:c,slot:"actions"})(({theme:e})=>({display:"inline-flex",alignItems:"center",height:e.spacing(4)}));function g({text:e}){let{useSession:t,ReactionActButton:n,ReplyActButton:i}=(0,l.OgA)(),{user:c}=t();return o.createElement("div",{"data-testid":"comment"},o.createElement(a.Z,{pt:1},o.createElement(s,null,o.createElement(d,null,o.createElement(r.Yt,{user:c,size:32})),o.createElement(u,null,o.createElement(a.Z,{p:0,borderRadius:2},o.createElement(v,null,o.createElement(p,{hoverCard:!0,to:`/user/${c.id}`,children:c.full_name})),o.createElement(m.Z,{text:e})),o.createElement(f,{className:"dotSeparators"},o.createElement(n,{minimize:!0}),o.createElement(i,{minimize:!0}))))))}let E=(0,i.ZP)("div",{name:"CommentListRoot"})(({theme:e})=>{var t;return{position:"relative","& $CommentRoot:first-of-type":{marginTop:e.spacing(1)},"& $CommentRoot:last-child":{borderBottom:"solid 1px",borderBottomColor:null===(t=e.palette.border)||void 0===t?void 0:t.secondary,paddingBottom:e.spacing(2),[e.breakpoints.down("sm")]:{borderBottom:"none"}}}}),x=(0,i.ZP)("div",{name:"CommentListRoot"})(({theme:e})=>{var t;return{position:"relative","&:before":{content:'""',position:"absolute",top:e.spacing(6),bottom:e.spacing(2),left:e.spacing(2),borderLeft:"solid 1px",borderLeftColor:null===(t=e.palette.border)||void 0===t?void 0:t.secondary}}});function y({identity:e,data:t,scrollToBottom:n,setParentReply:i}){let{useGetItem:r,CommentItemViewLiveStreaming:a}=(0,l.OgA)(),m=r(e),{preFetchingComment:c}=m||{},s=c&&Object.values(c).some(e=>{return(null==e?void 0:e.isLoading)===!0});return o.useEffect(()=>{n&&n()},[s,n]),o.createElement(E,null,(null==t?void 0:t.length)?t.map(e=>{return o.createElement(x,{key:null==e?void 0:e.id},o.createElement(a,{itemLive:e,identity:`comment.entities.comment.${null==e?void 0:e.id}`,setParentReply:i}))}):null,c?Object.values(c).filter(e=>{return(null==e?void 0:e.isLoading)===!0}).map(e=>o.createElement(x,{key:e},o.createElement(g,{text:e.text}))):null)}var b=(0,l.SuR)(function({streamKey:e,identity:t,scrollToBottom:n,setParentReply:i}){let{firebaseBackend:r,dispatch:a}=(0,l.OgA)(),m=r.getFirestore(),c=(0,l.zjB)(m,{collection:"live_video_comment",docID:e}),s=null==c?void 0:c.total_comment;if(o.useEffect(()=>{a({type:"livestreaming/updateStatistic",payload:{identity:t,statistic:{total_comment:s}}})},[s]),o.useEffect(()=>{a({type:"livestreaming/updateComment",payload:{data:null==c?void 0:c.comment}})},[null==c?void 0:c.comment]),!e||!c)return null;let d=null==c?void 0:c.comment.slice(Math.max((null==c?void 0:c.comment.length)-20,0));return o.createElement(y,{data:d,identity:t,scrollToBottom:n,setParentReply:i})})}}]);