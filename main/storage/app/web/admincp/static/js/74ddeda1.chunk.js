"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-livestreaming-blocks-LiveComment-CommentContainer"],{90643:function(e,t,n){n.r(t),n.d(t,{default:function(){return y}});var i=n(85597),o=n(67294),l=n(81719),a=n(16473),r=n(30120),m=n(30665);let s="PreFetchComment",c=(0,l.ZP)("div",{name:s,slot:"itemOuter"})(({theme:e})=>({display:"flex",opacity:.6,pointerEvents:"none","&:hover $ItemActionMenu":{visibility:"visible",marginLeft:e.spacing(.5)}})),d=(0,l.ZP)("div",{name:s,slot:"avatarWrapper"})(({theme:e})=>({marginRight:e.spacing(1)})),u=(0,l.ZP)("div",{name:s,slot:"itemInner"})(({theme:e})=>({display:"flex",flexDirection:"column",minWidth:0,wordBreak:"break-word"})),p=(0,l.ZP)("div",{name:s,slot:"itemName"})(({theme:e})=>({display:"flex",fontSize:e.mixins.pxToRem(13),marginBottom:e.spacing(.5)})),v=(0,l.ZP)(i.rUS,{name:s,slot:"userName"})(({theme:e})=>({fontSize:e.mixins.pxToRem(13),maxWidth:"100%",fontWeight:"bold"})),f=(0,l.ZP)("div",{name:s,slot:"actions"})(({theme:e})=>({display:"inline-flex",alignItems:"center",height:e.spacing(4)}));function g({text:e}){let{useSession:t,ReactionActButton:n,ReplyActButton:l}=(0,i.OgA)(),{user:s}=t();return o.createElement("div",{"data-testid":"comment"},o.createElement(r.Z,{pt:1},o.createElement(c,null,o.createElement(d,null,o.createElement(a.Yt,{user:s,size:32})),o.createElement(u,null,o.createElement(r.Z,{p:0,borderRadius:2},o.createElement(p,null,o.createElement(v,{hoverCard:!0,to:`/user/${s.id}`,children:s.full_name})),o.createElement(m.Z,{text:e})),o.createElement(f,{className:"dotSeparators"},o.createElement(n,{minimize:!0}),o.createElement(l,{minimize:!0}))))))}let E=(0,l.ZP)("div",{name:"CommentListRoot"})(({theme:e})=>{var t;return{position:"relative","& $CommentRoot:first-of-type":{marginTop:e.spacing(1)},"& $CommentRoot:last-child":{borderBottom:"solid 1px",borderBottomColor:null===(t=e.palette.border)||void 0===t?void 0:t.secondary,paddingBottom:e.spacing(2),[e.breakpoints.down("sm")]:{borderBottom:"none"}}}}),b=(0,l.ZP)("div",{name:"CommentListRoot"})(({theme:e})=>{var t;return{position:"relative","&:before":{content:'""',position:"absolute",top:e.spacing(6),bottom:e.spacing(2),left:e.spacing(2),borderLeft:"solid 1px",borderLeftColor:null===(t=e.palette.border)||void 0===t?void 0:t.secondary}}});function x({identity:e,data:t,scrollToBottom:n,setParentReply:l}){let{useGetItem:a,CommentItemViewLiveStreaming:r}=(0,i.OgA)(),m=a(e),{preFetchingComment:s}=m||{},c=s&&Object.values(s).some(e=>{return(null==e?void 0:e.isLoading)===!0});return o.useEffect(()=>{n&&n()},[c,n]),o.createElement(E,null,(null==t?void 0:t.length)?t.map(e=>{return o.createElement(b,{key:null==e?void 0:e.id},o.createElement(r,{itemLive:e,identity:`comment.entities.comment.${null==e?void 0:e.id}`,setParentReply:l}))}):null,s?Object.values(s).filter(e=>{return(null==e?void 0:e.isLoading)===!0}).map(e=>o.createElement(b,{key:e},o.createElement(g,{text:e.text}))):null)}var y=(0,i.SuR)(function({streamKey:e,identity:t,scrollToBottom:n,setParentReply:l}){let{firebaseBackend:a,dispatch:r}=(0,i.OgA)(),m=a.getFirestore(),s=(0,i.zjB)(m,{collection:"live_video_comment",docID:e}),c=null==s?void 0:s.total_comment;if(o.useEffect(()=>{r({type:"livestreaming/updateStatistic",payload:{identity:t,statistic:{total_comment:c}}})},[c]),o.useEffect(()=>{r({type:"livestreaming/updateComment",payload:{data:null==s?void 0:s.comment}})},[null==s?void 0:s.comment]),!e||!s)return null;let d=null==s?void 0:s.comment.slice(Math.max((null==s?void 0:s.comment.length)-20,0));return o.createElement(x,{data:d,identity:t,scrollToBottom:n,setParentReply:l})})}}]);