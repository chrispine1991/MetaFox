"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-chatplus-components-ChatRoomPanel-Header-FilterMessagesPopper","metafox-chatplus-components-Avatar"],{6867:function(e,t,r){r.d(t,{Z:function(){return k}});var n=r(63366),a=r(87462),i=r(67294),o=r(86010),l=r(2097),s=r(94780),c=r(1588),d=r(34867);function u(e){return(0,d.Z)("MuiBadge",e)}(0,c.Z)("MuiBadge",["root","badge","invisible"]);var p=r(34261),m=r(85893);let g=["badgeContent","component","children","invisible","max","slotProps","slots","showZero"],h=e=>{let{invisible:t}=e;return(0,s.Z)({root:["root"],badge:["badge",t&&"invisible"]},u,void 0)},v=i.forwardRef(function(e,t){let{component:r,children:i,max:o=99,slotProps:s={},slots:c={},showZero:d=!1}=e,u=(0,n.Z)(e,g),{badgeContent:v,max:f,displayValue:b,invisible:y}=function(e){let{badgeContent:t,invisible:r=!1,max:n=99,showZero:a=!1}=e,i=(0,l.Z)({badgeContent:t,max:n}),o=r;!1!==r||0!==t||a||(o=!0);let{badgeContent:s,max:c=n}=o?i:e,d=s&&Number(s)>c?`${c}+`:s;return{badgeContent:s,invisible:o,max:c,displayValue:d}}((0,a.Z)({},e,{max:o})),x=(0,a.Z)({},e,{badgeContent:v,invisible:y,max:f,showZero:d}),Z=h(x),w=r||c.root||"span",E=(0,p.Z)({elementType:w,externalSlotProps:s.root,externalForwardedProps:u,additionalProps:{ref:t},ownerState:x,className:Z.root}),O=c.badge||"span",P=(0,p.Z)({elementType:O,externalSlotProps:s.badge,ownerState:x,className:Z.badge});return(0,m.jsxs)(w,(0,a.Z)({},E,{children:[i,(0,m.jsx)(O,(0,a.Z)({},P,{children:b}))]}))});var f=r(81719),b=r(78884),y=r(69633),x=r(36622);function Z(e){return(0,d.Z)("MuiBadge",e)}let w=(0,c.Z)("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),E=["anchorOrigin","className","component","components","componentsProps","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],O=e=>{let{color:t,anchorOrigin:r,invisible:n,overlap:a,variant:i,classes:o={}}=e,l={root:["root"],badge:["badge",i,n&&"invisible",`anchorOrigin${(0,x.Z)(r.vertical)}${(0,x.Z)(r.horizontal)}`,`anchorOrigin${(0,x.Z)(r.vertical)}${(0,x.Z)(r.horizontal)}${(0,x.Z)(a)}`,`overlap${(0,x.Z)(a)}`,"default"!==t&&`color${(0,x.Z)(t)}`]};return(0,s.Z)(l,Z,o)},P=(0,f.ZP)("span",{name:"MuiBadge",slot:"Root",overridesResolver:(e,t)=>t.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),C=(0,f.ZP)("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[t.badge,t[r.variant],t[`anchorOrigin${(0,x.Z)(r.anchorOrigin.vertical)}${(0,x.Z)(r.anchorOrigin.horizontal)}${(0,x.Z)(r.overlap)}`],"default"!==r.color&&t[`color${(0,x.Z)(r.color)}`],r.invisible&&t.invisible]}})(({theme:e,ownerState:t})=>(0,a.Z)({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.pxToRem(12),minWidth:20,lineHeight:1,padding:"0 6px",height:20,borderRadius:10,zIndex:1,transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.enteringScreen})},"default"!==t.color&&{backgroundColor:(e.vars||e).palette[t.color].main,color:(e.vars||e).palette[t.color].contrastText},"dot"===t.variant&&{borderRadius:4,height:8,minWidth:8,padding:0},"top"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap&&{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${w.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}},"bottom"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap&&{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${w.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}},"top"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap&&{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${w.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}},"bottom"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap&&{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${w.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}},"top"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"circular"===t.overlap&&{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${w.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}},"bottom"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"circular"===t.overlap&&{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${w.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}},"top"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"circular"===t.overlap&&{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${w.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}},"bottom"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"circular"===t.overlap&&{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${w.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}},t.invisible&&{transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.leavingScreen})})),R=i.forwardRef(function(e,t){var r,i,s,c,d,u;let p;let g=(0,b.Z)({props:e,name:"MuiBadge"}),{anchorOrigin:h={vertical:"top",horizontal:"right"},className:f,component:x="span",components:Z={},componentsProps:w={},overlap:R="rectangular",color:k="default",invisible:M=!1,max:$,badgeContent:I,slots:z,slotProps:S,showZero:A=!1,variant:j="standard"}=g,B=(0,n.Z)(g,E),F=(0,l.Z)({anchorOrigin:h,color:k,overlap:R,variant:j}),_=M;!1!==M||(0!==I||A)&&(null!=I||"dot"===j)||(_=!0);let{color:T=k,overlap:N=R,anchorOrigin:W=h,variant:D=j}=_?F:g,H=(0,a.Z)({},g,{anchorOrigin:W,invisible:_,color:T,overlap:N,variant:D}),L=O(H);"dot"!==D&&(p=I&&Number(I)>$?`${$}+`:I);let U=null!=(r=null!=(i=null==z?void 0:z.root)?i:Z.Root)?r:P,q=null!=(s=null!=(c=null==z?void 0:z.badge)?c:Z.Badge)?s:C,X=null!=(d=null==S?void 0:S.root)?d:w.root,Q=null!=(u=null==S?void 0:S.badge)?u:w.badge;return(0,m.jsx)(v,(0,a.Z)({invisible:M,badgeContent:p,showZero:A,max:$},B,{slots:{root:U,badge:q},className:(0,o.default)(null==X?void 0:X.className,L.root,f),slotProps:{root:(0,a.Z)({},X,(0,y.Z)(U)&&{as:x,ownerState:(0,a.Z)({},null==X?void 0:X.ownerState,{anchorOrigin:W,color:T,overlap:N,variant:D})}),badge:(0,a.Z)({},Q,{className:(0,o.default)(L.badge,null==Q?void 0:Q.className)},(0,y.Z)(q)&&{ownerState:(0,a.Z)({},null==Q?void 0:Q.ownerState,{anchorOrigin:W,color:T,overlap:N,variant:D})})},ref:t}))});var k=R},69633:function(e,t,r){var n=r(28442);let a=e=>{return!e||!(0,n.Z)(e)};t.Z=a},69709:function(e,t,r){r.r(t);var n=r(85597),a=r(27274),i=r(7961),o=r(6867),l=r(81719),s=r(62097),c=r(67294),d=r(93836),u=r(42977),p=r(17563);let m=(0,l.ZP)(i.Z,{name:"AvatarWrapper"})(({theme:e})=>({borderWidth:"thin",borderStyle:"solid",borderColor:e.palette.border.secondary})),g=(0,l.ZP)(n.rUS,{name:"Link"})(({theme:e})=>({"&:hover":{textDecoration:"none"}})),h=(0,l.ZP)(o.Z,{shouldForwardProp:e=>"status"!==e})(({theme:e,status:t})=>({"& .MuiBadge-badge":{...0===t&&{display:"none"},...1===t&&{color:e.palette.success.main,backgroundColor:e.palette.success.main},...2===t&&{color:e.palette.warning.main,backgroundColor:e.palette.warning.main},...3===t&&{color:e.palette.error.main,backgroundColor:e.palette.error.main},boxShadow:"dark"===e.palette.mode?"none":`0 0 0 2px ${e.palette.background.paper}`,"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}}})),v=(0,l.ZP)("div",{shouldForwardProp:e=>"sizeProps"!==e})(({theme:e,sizeProps:t})=>({position:"relative",width:"32px",height:"32px",...t&&{width:t,height:t}})),f=(0,l.ZP)(i.Z,{shouldForwardProp:e=>"sizeProps"!==e})(({theme:e,sizeProps:t})=>({position:"absolute",bottom:0,left:0,width:"26px",height:"26px",backgroundColor:"dark"===e.palette.mode?e.palette.grey["600"]:e.palette.grey["300"],borderWidth:1,borderStyle:"solid",borderColor:"light"===e.palette.mode?e.palette.grey["50"]:e.palette.grey["800"],zIndex:2,...t&&{width:t-6,height:t-6}})),b=(0,l.ZP)(i.Z,{shouldForwardProp:e=>"sizeProps"!==e})(({theme:e,sizeProps:t})=>({position:"relative",top:-2,left:6,width:"26px",height:"26px",...t&&{width:`${t-6}px !important`,height:`${t-6}px !important`}}));t.default=(0,c.memo)(function({username:e="Name",name:t="Name",src:r,size:o,to:l,onClick:y,status:x=0,room:Z,uploadLocal:w=!1,roomType:E=null,avatarETag:O,hoverCard:P=!1,component:C="span",target:R="_self"}){var k,M;let{getSetting:$}=(0,n.OgA)(),I=(0,s.Z)(),z=E||(null==Z?void 0:Z.t),S=(0,a.vK)(t),A={width:o,height:o,color:I.palette.grey["50"],fontSize:o/3},j=$("chatplus"),B=null==j?void 0:null===(k=j.server)||void 0===k?void 0:k.replace(/\/$/,""),F=r;if(F||(F=O?`${B}/avatar/${e}?${p.stringify({etag:O})}`:""),S&&(A.backgroundColor=a.kU.hex(S)),l)return c.createElement(g,{target:R,to:l||`/${e}`},c.createElement(m,{src:F,alt:t,style:A,component:C,children:S}));if([d.n.Private,d.n.Public].includes(z)){if(w)return c.createElement(m,{src:F,alt:t,style:A,component:C,children:S});if(null==Z?void 0:Z.avatarETag)return F=`${B}/avatar/room/${null==Z?void 0:Z.id}?${p.stringify({etag:null==Z?void 0:Z.avatarETag})}`,c.createElement(m,{src:F,alt:t,style:A,component:C,children:S});{let _=`${B}/avatar/${null==Z?void 0:null===(M=Z.u)||void 0===M?void 0:M.username}`;return c.createElement(v,{sizeProps:o},c.createElement(f,{sizeProps:o,src:_,alt:t,component:C,children:S}),c.createElement(b,{sizeProps:o,src:F,alt:t,style:A,component:C,children:S}))}}if(z===d.n.Direct&&x){let T=(0,u.xW)(x);return c.createElement(h,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",status:T},c.createElement(i.Z,{src:F,alt:t,style:A,component:C,children:S,hoverCard:P}))}return c.createElement(m,{src:F,alt:t,style:A,component:C,children:S,onClick:y,to:e,hoverCard:P})})},35034:function(e,t,r){r.r(t),r.d(t,{default:function(){return F}});var n=r(39312),a=r(85597),i=r(21241),o=r(77029),l=r(30120),s=r(25722),c=r(62937),d=r(81719),u=r(91647),p=r(67294),m=r(41609),g=r.n(m),h=r(93836),v=r(42977),f=r(27274),b=r(86010),y=r(96095),x=r(59045),Z=r(83940);let w="MsgItemFilterPopper",E=(0,d.ZP)("div",{name:w,slot:"uiChatMsgItemBody",shouldForwardProp:e=>"file"!==e})(({theme:e,file:t})=>({display:t?"block":"flex"})),O=(0,d.ZP)("div",{name:w,slot:"uiChatMsgSet",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e&&"isGroup"!==e&&"file"!==e})(({theme:e,isOwner:t,isAlert:r,isGroup:n,file:a})=>({display:"flex",flexDirection:"row",padding:e.spacing(1.25),borderBottom:e.mixins.border("secondary"),width:"100%",...r&&{"&.uiChatMsgSetAvatar":{display:"none"},"&.uiChatMsgItemCall":{border:"none"},"&.uiChatMsgActions":{justifyContent:"center","&.my-1; .btn":{"&.mx-1":"!important"}}},...t&&{flexDirection:"row-reverse"}})),P=(0,d.ZP)("div",{name:w,slot:"uiChatMsgSetAvatar"})(({theme:e})=>({marginRight:e.spacing(1)})),C=(0,d.ZP)("span")(({theme:e})=>({...e.typography.h5})),R=(0,d.ZP)("span")(({theme:e})=>({padding:e.spacing(.5,0)})),k=(0,d.ZP)(l.Z)(({theme:e})=>({display:"flex",flexDirection:"column",width:"calc(100% - 40px)"}));function M({msgId:e,user:t,tooltipPosition:r,isMobile:i,showToolbar:o=!0,isRoomLimited:s,room:c,type:d}){var u,m,g;let w=`chatplus.chatRooms.${c.id}.messageFilter.${e}`,M=(0,n.v2)(w),{jsxBackend:$}=(0,a.OgA)(),[I,z]=(0,a.zXz)(w,{}),S=(0,n.XP)(null==c?void 0:c.id),A=(0,n.Fy)(),j=(0,n.jS)(null==c?void 0:c.id),B=!((null==j?void 0:j.allowMessageFrom)!=="noone"),{_id:F,t:_,system:T,attachments:N,reactions:W,msgType:D,ts:H,u:L,starred:U}=M||{},q=(0,n.ID)(null==L?void 0:L._id),X=t._id===(null==L?void 0:L._id),Q=(0,v.qF)(N),Y=(null==N?void 0:N.length)?null===(u=N.filter(e=>e.image_url))||void 0===u?void 0:u.length:null,G=!!((null==c?void 0:c.t)===h.n.Direct&&((null==j?void 0:j.metafoxBlocked)||(null==j?void 0:j.metafoxBlocker))),K=!!((null==c?void 0:c.t)===h.n.Direct&&((null==j?void 0:j.blocked)||(null==j?void 0:j.blocker))),J=!!(K||G),V=null==U?void 0:U.find(e=>e._id===t._id),ee=(null==A?void 0:A.Message_AllowStarring)&&!B&&!J,et=A.Message_AllowPinning&&S["pin-message"]&&!s&&!B&&!J,er=(S["force-delete-message"]||A.Message_AllowDeleting&&(S["delete-message"]||X&&S["delete-own-message"]))&&!B&&!J,en=p.useMemo(()=>[{label:"unpin",icon:"ico-magic",value:"chatplus/unpinAndremoveMessage",testid:"unpinMessage",showWhen:["and",["truthy","allowPinning"],["truthy","item.pinned"],["eq","type","pin"]]},{label:"remove_star",icon:"ico-star-o",value:"chatplus/unstarAndremoveMessage",testid:"unstarMessage",showWhen:["and",["truthy","allowStarring"],["truthy","isStarred"],["eq","type","star"]]},{label:"delete",icon:"ico-trash-o",className:"item-delete",value:"chatplus/deleteMessage",testid:"deleteMessage",showWhen:["and",["truthy","canDelete"]]}],[]),ea=p.useMemo(()=>(0,f.W$)(en,{allowPinning:et,item:M,allowStarring:ee,isStarred:V,canDelete:er,type:d}),[en,et,M,ee,V,er,d]);return M?p.createElement(O,{file:Boolean(1===Q||!Y&&(null==M?void 0:M.file)||(null==M?void 0:null===(m=M.urls)||void 0===m?void 0:m.length))},p.createElement(P,null,p.createElement(Z.Z,{name:(null==q?void 0:q.name)||(null==L?void 0:L.name),username:(null==q?void 0:q.username)||(null==L?void 0:L.username),avatarETag:(null==L?void 0:L.avatarETag)||(null==q?void 0:q.avatarETag),size:32})),p.createElement(k,null,p.createElement(l.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start"}},p.createElement(l.Z,{sx:{display:"flex",flexDirection:"column"}},p.createElement(C,null,(null==L?void 0:L.username)?null==L?void 0:L.username:null==L?void 0:L.name),p.createElement(R,null,(0,v.jF)(null==H?void 0:H.$date))),p.createElement(x.Z,{identity:w,items:ea,handleAction:I,disabled:!1,disableReact:!0,state:z,showHover:!1})),p.createElement("div",{className:"uiChatMsgItem","data-id":F,"data-t":_},p.createElement(E,{file:Boolean(1===Q||!Y&&(null==M?void 0:M.file)||(null==M?void 0:null===(g=M.urls)||void 0===g?void 0:g.length))},p.createElement("div",{className:(0,b.default)("uiChatMsgItemBodyOuter",{hasToolbar:o&&!T,"multi-image":Q>1})},$.render({component:"chatplus.messageContent.standard",props:{message:M,isOwner:!1,user:t,createdDate:null,isRoomLimited:s,msgType:D,tooltipPosition:i?"top":r}})),p.createElement(x.Z,{identity:w,handleAction:I,disabled:T||!o,disableReact:!0,state:z})),p.createElement(y.Z,{identity:w,disabled:!W||T,reactions:W,handleAction:I})))):null}let $="MessageFilterPopper",I=(0,d.ZP)("div",{name:$,slot:"root"})(({theme:e})=>({width:"100%"})),z=(0,d.ZP)("div",{name:$,slot:"noItemFound"})(({theme:e})=>({...e.typography.body1,padding:e.spacing(1,2),color:e.palette.grey["600"],margin:e.spacing(1,0),textAlign:"center"})),S=({archived:e,settings:t,user:r,disableReact:n,room:i,items:o,phraseNoContent:l="no_results_found",type:s})=>{let{i18n:c}=(0,a.OgA)();return g()(o)?p.createElement(z,null,c.formatMessage({id:l})," "):p.createElement(I,null,o&&Object.values(o).map(a=>p.createElement(M,{key:a._id,msgId:a._id,archived:e,settings:t,perms:{},isMobile:!1,user:r,disableReact:n,room:i,type:s})))};function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}let j=(0,d.ZP)("div")(({theme:e})=>({display:"flex",alignItems:"flex-end"})),B=(0,d.ZP)(l.Z,{shouldForwardProp:e=>"noContent"!==e})(({theme:e,noContent:t})=>{var r;return{padding:e.spacing(1.5,2),display:"flex",alignItems:"center",justifyContent:"space-between",...!t&&{borderBottom:"1px solid",borderColor:null===(r=e.palette.border)||void 0===r?void 0:r.secondary}}});function F({anchorRef:e,open:t,placement:r,type:l,closePopover:d,...m}){let{i18n:g,usePageParams:h,dispatch:v}=(0,a.OgA)(),f=h(),{rid:b}=f,y=(0,n.dC)(b),x=(0,n.Oy)(),Z=(0,n.jS)(b),w=(0,n.F5)(b),E=(0,n.Fy)(),O=!!(null==Z?void 0:Z.archived);return p.useEffect(()=>{return"pin"===l&&v({type:"chatplus/room/searchMessages",payload:{roomId:null==w?void 0:w.id,filter:"pin"}}),"star"===l&&v({type:"chatplus/room/searchMessages",payload:{roomId:null==w?void 0:w.id,filter:"star"}}),()=>{v({type:"chatplus/room/deleteMessagesFilter",payload:{identity:null==w?void 0:w.id}})}},[l]),p.createElement(o.Qn,{excludeRef:e,onClickAway:d},p.createElement(c.Z,A({id:"chatplus","data-testid":"chatplus",anchorEl:null==e?void 0:e.current,open:t,placement:r||"bottom-end"},m),p.createElement(s.Z,{sx:{width:320,overflow:"hidden",userSelect:"none"}},p.createElement(B,null,p.createElement(j,null,p.createElement(u.Z,{variant:"h4"},g.formatMessage({id:"pin"===l?"pinned_messages":"starred_messages"})))),p.createElement(i.l$,{autoHide:!0,autoHeight:!0,autoHeightMax:390,autoHeightMin:40},p.createElement(S,{user:x,items:y,archived:O,room:w,isMobile:!1,settings:E,disableReact:!0,phraseNoContent:"pin"===l?"no_pinned_messages":"no_starred_messages",type:l})))))}},83940:function(e,t,r){var n=r(93836),a=r(67294),i=r(69709);t.Z=(0,a.memo)(function({username:e,name:t,size:r="sm",status:o=null,room:l=null,avatarETag:s,hoverCard:c}){return a.createElement(i.default,{username:e,size:r,name:t,roomType:n.n.Direct,status:o,room:l,avatarETag:s,hoverCard:c})})},96095:function(e,t,r){r.d(t,{Z:function(){return v}});var n=r(85597),a=r(81719),i=r(67294),o=r(40471),l=r(47037),s=r.n(l);let c=(0,a.ZP)("span")(({theme:e})=>({display:"inline-flex",alignItems:"center",justifyContent:"center",margin:e.spacing(0,.25)})),d=(0,a.ZP)("img")(({theme:e})=>({width:15,height:15}));function u({id:e,usernames:t}){let r=(0,o.z)();if(!e||!t)return null;let n=s()(e)&&e.split(":")[1].split("_")[1];if(!n||!r)return null;let a=r.find(e=>e.id===parseInt(n));return i.createElement(c,null,i.createElement(d,{src:null==a?void 0:a.src,draggable:!1,alt:null==a?void 0:a.title}))}function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}let m=(0,a.ZP)("div",{shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",margin:0,padding:0,marginBottom:e.spacing(-1),...t&&{flexDirection:"row-reverse"}})),g=(0,a.ZP)("span")(({theme:e})=>({marginLeft:e.spacing(.5),position:"relative",top:"-1px",fontSize:e.typography.pxToRem(14),height:e.spacing(2.5),fontWeight:e.typography.fontWeightRegular})),h=(0,a.ZP)("div")(({theme:e})=>({cursor:"pointer",color:e.palette.grey["800"],backgroundColor:e.palette.grey["50"],position:"relative",borderRadius:e.spacing(1),lineHeight:e.spacing(2.5),whiteSpace:"nowrap",display:"inline-flex",alignItems:"center",padding:e.spacing(.5,.75),boxShadow:"0px 0px 15px 0px #00000026",transform:"translateY(-10px)",height:e.spacing(3),zIndex:2}));function v({identity:e,disabled:t,reactions:r,isOwner:a,handleAction:o}){let{dispatch:l}=(0,n.OgA)(),s=()=>{l({type:"chatplus/presentReactionsList",payload:{identity:e}})};if(t||!r||!Object.keys(r).length)return null;let c=0,d=Object.keys(r).sort((e,t)=>{var n,a,i,o,l,s,c,d;return((null===(n=r[t])||void 0===n?void 0:null===(a=n.usernames)||void 0===a?void 0:a.length)||1)-((null===(i=r[e])||void 0===i?void 0:null===(o=i.usernames)||void 0===o?void 0:o.length)||1)-((null===(l=r[t])||void 0===l?void 0:null===(s=l.updatedAt)||void 0===s?void 0:s.$date)||1)-((null===(c=r[e])||void 0===c?void 0:null===(d=c.updatedAt)||void 0===d?void 0:d.$date)||1)}).reduce((e,t)=>{var n,a;return c+=null===(n=r[t])||void 0===n?void 0:null===(a=n.usernames)||void 0===a?void 0:a.length,{...e,[t]:r[t]}},{});return i.createElement(m,{isOwner:a},i.createElement(h,{onClick:s},Object.keys(d).slice(0,3).map((e,t)=>i.createElement(u,p({id:e},d[e],{key:`k${t}`}))),i.createElement(g,null,c)))}},59045:function(e,t,r){r.d(t,{Z:function(){return S}});var n=r(85597),a=r(81719),i=r(67294),o=r(77029),l=r(21822),s=r(38790);function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}let d="MsgActionMenu",u=(0,a.ZP)("div",{name:d,slot:"root"})(({theme:e})=>({"& .MuiActionMenu-menu":{overflowY:"auto",overflowX:"hidden",maxHeight:"260px",maxWidth:"170px","&::-webkit-scrollbar":{height:"6px",width:"6px",borderRadius:"3px",transition:"opacity 200ms"},"&::-webkit-scrollbar-track":{borderRadius:"3px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,.2)",borderRadius:"3px"},"&::-webkit-scrollbar-thumb:horizontal":{background:"#000",borderRadius:"10px"}}})),p=(0,a.ZP)(l.Z,{name:d,slot:"UIChatItemBtn",shouldForwardProp:e=>"showHover"!==e})(({theme:e,showHover:t})=>({position:"relative",visibility:t?"hidden":"unset",padding:e.spacing(1,.5),cursor:"pointer",minWidth:e.spacing(3),lineHeight:e.spacing(2.5),color:"light"===e.palette.mode?e.palette.grey["600"]:e.palette.text.secondary}));function m({identity:e,handleAction:t,scrollRef:r,items:a,showHover:l=!0,placement:d="auto-start",...m}){let{ItemActionMenu:g,i18n:h}=(0,n.OgA)();return i.createElement(u,null,i.createElement(g,c({items:a,placement:d,identity:e,handleAction:t,dependName:"chatplus/msgActionMenu",scrollRef:r,scrollClose:!0},m,{control:i.createElement(s.Z,{title:h.formatMessage({id:"more"}),placement:"top",PopperProps:{disablePortal:!0}},i.createElement(p,{showHover:l,disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0,className:"uiChatItemBtn"},i.createElement(o.zb,{icon:"ico-dottedmore-vertical-o"})))})))}var g=r(25722),h=r(62937),v=r(39312),f=r(40471),b=r(86010),y=r(22410),x=r(73327),Z=r(41609),w=r.n(Z);let E=(0,y.Z)(e=>(0,x.Z)({paper:{borderRadius:24,margin:0,padding:0},itemsRoot:{display:"flex",flexDirection:"row"},itemRoot:{padding:"4px",display:"flex",alignItem:"center",alignSelf:"center"},itemImage:{width:27,height:27},active:{background:e.palette.grey["300"],padding:e.spacing(.5),borderRadius:e.spacing(1),width:34,height:34,display:"flex",alignItem:"center",justifyContent:"center",margin:e.spacing(.2)}}),{name:"ReactionThisItemPopover"}),O=({item:e,classes:t,onClick:r,active:n})=>{return i.createElement("div",{className:(0,b.default)(t.itemRoot,n&&t.active),role:"button",onClick:r,"aria-label":e.title,"data-testid":"itemReaction"},i.createElement(s.Z,{title:e.title},i.createElement("img",{src:e.src,draggable:!1,alt:e.title,className:t.itemImage})))};var P=function({onEmojiClick:e,unsetReaction:t,identity:r}){let n=(0,f.z)(),a=E(),o=(0,v.v2)(r),l=(0,v.Oy)(),s=l.username,c=e=>{var t,r,n;return!w()(null==o?void 0:null===(t=o.reactions)||void 0===t?void 0:t[e])&&(null===(r=o.reactions)||void 0===r?void 0:null===(n=r[e])||void 0===n?void 0:n.usernames.includes(s))},d=r=>{let n=c(r);n?t(r):e(r,null)};return i.createElement("div",{className:a.itemsRoot},n.map(e=>i.createElement(O,{key:e.id.toString(),onClick:()=>{d(`:reaction_${e.id.toString()}:`)},classes:a,item:e,active:c(`:reaction_${e.id}:`)})))};let C=(0,a.ZP)(g.Z)(({theme:e})=>({margin:0,padding:e.spacing(0,.5),maxHeight:"48px",display:"flex",alignItems:"center",whiteSpace:"nowrap"}));function R({onEmojiClick:e,multiple:t=!0,disabled:r,scrollRef:a,scrollClose:l,placement:s="top",label:c="react",control:d,identity:u,unsetReaction:p}){let{i18n:m}=(0,n.OgA)(),g=m.formatMessage({id:c}),[v,f]=i.useState(null),b=i.useRef(),[y,x]=i.useState(!1),Z=i.useCallback(()=>{x(!1)},[]),w=i.useCallback(e=>{x(e=>!e),f(v?null:e.currentTarget)},[]),E=i.useCallback((r,n)=>{e&&e(r,n),t||x(!1)},[t,e]),O=i.useCallback(e=>{p&&p(e),x(!1)},[p]);return i.useEffect(()=>{if(y&&a&&a.current&&l){let e=()=>x(!1);return a.current.addEventListener("scroll",e),()=>{null==a||a.current.removeEventListener("scroll",e)}}},[y]),i.createElement(i.Fragment,null,i.createElement(o.Qn,{excludeRef:b,onClickAway:Z},i.createElement(d,{onClick:w,disabled:r,title:g,"data-testid":"buttonAttachEmoji",icon:"ico-smile-o"})),i.createElement(h.Z,{ref:b,open:y,anchorEl:v,placement:s,role:"presentation",style:{zIndex:5e3}},i.createElement(C,{"data-testid":"dialogEmojiPicker"},i.createElement(P,{onEmojiClick:E,unsetReaction:O,identity:u}))))}function k(){return(k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}let M=(0,a.ZP)(l.Z,{name:"MsgEmojiPicker",slot:"UIChatItemBtn"})(({theme:e})=>({position:"relative",visibility:"hidden",padding:e.spacing(1,.75),cursor:"pointer",minWidth:e.spacing(2.5),lineHeight:e.spacing(2.5),color:"light"===e.palette.mode?e.palette.grey["600"]:e.palette.text.secondary})),$=i.forwardRef(({title:e,...t},r)=>{return i.createElement(s.Z,{title:e,placement:"top",PopperProps:{disablePortal:!0}},i.createElement(M,k({className:"uiChatItemBtn uiChatIconBtn",disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0},t,{ref:r}),i.createElement(o.zb,{icon:"ico-smile-o"})))});function I({handleAction:e,scrollRef:t,identity:r}){let n=i.useCallback((t,r=null)=>e("chatplus/messageReaction",{shortcut:t,unicode:r}),[e]),a=i.useCallback(t=>{e("chatplus/unsetReaction",{identity:r,shortcut:t})},[e]);return i.createElement(R,{size:"small",multiple:!1,onEmojiClick:n,unsetReaction:a,control:$,scrollRef:t,scrollClose:!0,identity:r})}let z=(0,a.ZP)("div",{name:"MsgToolbar",slot:"uiChatToolbar",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",justifyContent:"center",alignItems:"center",...!t&&{flexDirection:"row-reverse"}}));function S({items:e,disabled:t,disableReact:r,handleAction:a,identity:o,isOwner:l,showHover:s,placement:c}){let{useScrollRef:d}=(0,n.OgA)(),u=d();return t?null:i.createElement(z,{isOwner:l,className:"uiChatToolbar"},i.createElement(m,{identity:o,items:e,scrollRef:u,handleAction:a,showHover:s,placement:c,popperOptions:{strategy:"fixed"}}),r?null:i.createElement(I,{scrollRef:u,handleAction:a,identity:o}))}}}]);